if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from}return-1}}var zhiyou_relate={baseUrl:"//zhiyou.smzdm.com/",loginUrl:"https://zhiyou.smzdm.com/",iframe_url:"https://zhiyou.smzdm.com/user/login/window/#redirect_url=",init:function(){var me=this},gotChannelName:function(location){var map={"www.smzdm.com":"首页_","www.smzdm.com/p/":"商品详情_","post.smzdm.com":"原创_","post.smzdm.com/p/":"原创详情_","faxian.smzdm.com":"发现_","haitao.smzdm.com":"海淘_","2.smzdm.com":"闲值_","news.smzdm.com":"资讯_","news.smzdm.com/p/":"资讯详情_","search.smzdm.com":"搜索_","wiki.smzdm.com":"百科_","wiki.smzdm.com/p/":"百科_","test.smzdm.com":"众测_","test.smzdm.com/p/":"众测_","auto.smzdm.com":"汽车_","lvyou.smzdm.com":"旅游_","zhiyou.smzdm.com":"个人中心_","www.smzdm.com/fenlei/":"分类_","duihuan.smzdm.com":"福利_","new.brand.smzdm.com":"新品牌_"};var pathnameArr=location.pathname.split("/");var channelName="";var _gotPathName=function(){if(pathnameArr.indexOf("p")===1){return"/p/"}else if(pathnameArr.indexOf("fenlei")===1){return"/fenlei/"}else{return""}};var realHref=location.hostname+_gotPathName();for(var i in map){if(realHref===i){channelName=map[i];break}}if(channelName){return channelName}else{return""}},popup_login_init:function(config){var channelName=zhiyou_relate.gotChannelName(window.location);var dataPushHandler=function(event){return channelName!==""?'dataLayer.push({"event":"'+channelName+event+'"})':""};var redirect_url=window.location.href;if(config.redirect_url!=undefined){redirect_url=config.redirect_url}zhiyou_relate.iframe_url="https://zhiyou.smzdm.com/user/login/window/#redirect_url="+encodeURIComponent(redirect_url);var iframe_html='<div class="pop" id="pop-login-new" style="display:none;margin-left:-240px;top:30%;">'+"<i onclick='"+dataPushHandler("关闭按钮")+"' class='pop-close icon-cross-lighter'><!--[if lt IE 8]>x<![endif]--></i>"+'<div class="pop-title">'+"</div>"+'<div class="pop-content">'+'<iframe id="zhiyou_login_window_iframe" frameborder="0" style="width:315px;height:310px;" src=""'+' scrolling="no"></iframe>'+"</div></div>"+'<div id="cover" style="display: none;"></div>';var length="",login_pop="",cover="";if($("#pop-login-new").length<=0){$("#footer").after(iframe_html)}login_pop=$("#pop-login-new");cover=$("#cover");$(document).on("click",".zhiyou_login",function(){if(channelName&&typeof dataLayer!="undefined"){dataLayer.push({event:channelName+"登录弹窗_出现次数"});$("#cover").attr("onclick",'dataLayer.push({"event":"'+channelName+'半透明区域"})')}zhiyou_relate.popup_login_show()});$(document).on("click",".J_login_trigger",function(e){e.preventDefault();var that=$(this);if(channelName&&typeof dataLayer!="undefined"){dataLayer.push({event:channelName+"_登录弹窗_出现次数","频道名":channelName});$("#cover").attr("onclick",'dataLayer.push({"event":"'+channelName+'_半透明区域","频道名":"'+channelName+'"})')}zhiyou_relate.popup_login_show();if(that.data("style")=="login"){var ifr=document.getElementById("zhiyou_login_window_iframe");ifr.onload=function(){var dataJson=JSON.stringify({type:2});ifr.contentWindow.postMessage(dataJson,"*")}}});$(document).on("click",".J_register_trigger",function(e){e.preventDefault();var that=$(this);if(channelName&&typeof dataLayer!="undefined"){dataLayer.push({event:channelName+"_登录弹窗_出现次数","频道名":channelName});$("#cover").attr("onclick",'dataLayer.push({"event":"'+channelName+'_半透明区域","频道名":"'+channelName+'"})')}zhiyou_relate.popup_login_show();if(that.data("style")=="register"){var ifr=document.getElementById("zhiyou_login_window_iframe");ifr.onload=function(){var dataJson=JSON.stringify({type:1});ifr.contentWindow.postMessage(dataJson,"*")}}});$("#pop-login-new").delegate(".pop-close","click",function(){login_pop.hide();cover.hide();zhiyou_relate.popup_login_refresh()});$(document).on("click","#cover",function(){login_pop.hide();cover.hide();zhiyou_relate.popup_login_refresh()});if(window.addEventListener){window.addEventListener("message",function(e){if(e.origin!=="https://zhiyou.smzdm.com")return;var data=JSON.parse(e.data);if(data.agreeStatusType===1){zhiyou_relate.reset_login_iframe()}else if(data.agreeStatusType===2){var ifr=document.getElementById("zhiyou_login_window_iframe");zhiyou_relate.reset_login_iframe();ifr.onload=function(){var dataJson=JSON.stringify({agreeType:"register_post"});ifr.contentWindow.postMessage(dataJson,"*")}}},false)}else{if(window.attachEvent){window.attachEvent("onmessage",function(e){if(e.origin!=="https://zhiyou.smzdm.com")return;var data=JSON.parse(e.data);if(data.agreeStatusType===1){zhiyou_relate.reset_login_iframe()}else if(data.agreeStatusType===2){var ifr=document.getElementById("zhiyou_login_window_iframe");zhiyou_relate.reset_login_iframe();ifr.onload=function(){var dataJson=JSON.stringify({agreeType:"register_post"});ifr.contentWindow.postMessage(dataJson,"*")}}})}}},reset_login_iframe:function(){$("#cover").remove();$("#cover").remove();$("body").append("<div class='J_cover_pop'></div>");$(".J_cover_pop").css({position:"fixed","z-index":"9999",top:"0",left:"0",width:"100%",height:"100%",background:"#000",filter:"alpha(opacity=50)",opacity:"0.5"});$("#pop-login-new .pop-close").hide();$("#pop-login-new .pop-title").hide();$("#pop-login-new .pop-content").css({padding:"0",width:"495px",height:"413px"});$("#zhiyou_login_window_iframe").css({width:"495px",height:"413px"})},popup_login_refresh:function(){var $ifr=$("#zhiyou_login_window_iframe");var prevUrl=$ifr.attr("src");if(prevUrl!==""){prevUrl=""}$ifr.attr("src","");setTimeout(function(){$ifr.attr("src",prevUrl)},0)},popup_login_show:function(){var $ifr=$("#zhiyou_login_window_iframe");var prevUrl=$ifr.attr("src");if(typeof call_client_login==="function"){call_client_login()}else if($(window).width()<=480){window.location=zhiyou_relate.iframe_url}else{if(prevUrl===""){$ifr.attr("src",zhiyou_relate.iframe_url)}$("#pop-login-new").show();$("#cover").show()}return false},request_zhiyou_info:function(callback){var me=this;var baseUrl=me.baseUrl;if(window.location.protocol==="https:"){baseUrl=baseUrl.replace(/http/g,"https")}var userUrl=baseUrl+"user/info/jsonp_get_current";$.ajax({type:"get",url:userUrl,data:"",dataType:"jsonp",jsonp:"callback",success:function(resp){if(resp.is_agree_protocol===0){if(!/smzdmapp/i.test(navigator.userAgent)){$(".J_login_trigger").click();var ifr=document.getElementById("zhiyou_login_window_iframe");ifr.onload=function(){var agreeDataJson=JSON.stringify({agreeType:"reload_post"});zhiyou_relate.reset_login_iframe();ifr.contentWindow.postMessage(agreeDataJson,"*")}}}else{zhiyou_relate.user_info=resp;resp.smzdm_id=parseInt(resp.smzdm_id);if(resp.smzdm_id!=0&&resp.bgm.length!=0){setCookie("HAVE_BGM",1,"","/",".smzdm.com")}else{deleteCookie("HAVE_BGM")}me.user_info_default_callback(resp);if(typeof callback=="function"&&resp.smzdm_id){callback(resp)}me.extra_user_info_callback(resp);user_foucs_callback(resp)}},error:function(){}})},user_info:{},bgm:{},user_info_default_callback:function(resp){var me=zhiyou_relate;var channelName=me.gotChannelName(window.location);var sub_nav_li=$(".J_user_entry .sub-nav li").slice(1,11);var sub_entry=$(".submit-entry");if(resp.is_business&&sub_entry.length){sub_entry.hide();sub_nav_li.hide()}if(resp.smzdm_id){if(!!resp.is_show_video){if($("#global-nav ul.control-list li.user-entry ul.sub-nav").find("li").eq(5).find("a").html()!="我的视频"){var _click="{'event': '通用_个人中心导航', '按钮名称': '我的视频'}";var elementVideo=document.createElement("li");elementVideo.innerHTML='<a href="http://zhiyou.smzdm.com/user/v/" target="_blank" onclick="dataLayer.push('+_click+')">我的视频</a>';$("#global-nav ul.control-list li.user-entry ul.sub-nav").find("li").eq(4).after(elementVideo)}var videoTG=false;for(var i=0;i<$(".submit-entry .sub-nav").find("li").size();i++){if($(".submit-entry .sub-nav").find("li").eq(i).find("a").html()=="视频投稿"){videoTG=true}}if(!videoTG){var element=document.createElement("li");element.innerHTML='<a href="http://v.smzdm.com/baoliao/" target="_blank">视频投稿</a>';$(".submit-entry .sub-nav").append(element)}}if(channelName&&typeof dataLayer!="undefined"){dataLayer.push({event:channelName+"登录成功_次数"})}else{console.log("href:",window.location.href);console.log("若href存在于字典，则dataLayer还未定义")}if(resp["bgm"]&&!$.isEmptyObject(resp["bgm"])){zhiyou_relate.bgm=resp["bgm"]}var smzdm_id=resp.smzdm_id;var nickname=resp.nickname;var unread=resp.unread;var logo=resp.logo;var authority=resp.capabilities;var a=resp.avatar.split("small");var avatarUrl=typeof a[0]!="undefined"?a[0]:"";if(typeof a[1]!="undefined"){avatarUrl+="middle"+a[1]}var personLink=zhiyou_relate.baseUrl+"user";var point=resp.point;var gold=resp.gold;var is_anonymous="";var checkin=resp.checkin;var commentConnect=resp.comment_sync_sina;$("body").append('<input id="log_status" type="hidden" value="1" />');if(authority!=""){if(authority.administrator||authority.editor||authority.pinglun||authority.edit_posts||authority.moderate_comments){$("body").append('<input type="hidden" id="authority" value="editor" />');$("#authority").val("all")}}$(".J_login_trigger").parent().hide();$(".J_user_entry").show();$(".J_nav_username").html(resp.nickname);if($("#user_info").length>0){$("#user_info").attr("class","userInfo user_signIn");$("#sign_login").hide();$("#user_info_avatar").attr({src:avatarUrl,alt:nickname}).unwrap("span").wrap('<a href=" '+personLink+' " class="userPic" target="_blank"></a>');$("#user_info_name").html('<a href=" '+personLink+' " title=" '+nickname+' " target="_blank">'+nickname+"</a>"+logo.medal+logo.zhongce_grade+logo.goldbl+" "+logo.rank);if($("#user_info_score").find("em").length>0){$("#user_info_score").find("em").html(point).end().next("a").andSelf().show()}else{$("#user_info_score").html("积分:<em>"+point+"</em>")}if($("#user_info_gold").find("em").length>0){$("#user_info_gold").find("em").html(gold).end().next("a").andSelf().show()}else{$("#user_info_gold").html("金币:<em>"+gold+"</em>")}var mobileTips=parseInt($("#user_info").attr("needMobileTips"));if(mobileTips!=1){}$("#user_info_tosign").unbind("click").bind("click",zhiyou_relate.set_checkin);if(checkin.has_checkin){$("#user_info_tosign").html("已签到"+checkin.daily_checkin_num+"天").removeClass("signScore").addClass("signScored").removeClass("zhiyou_login").unbind("click");if(mobileTips!=1){$("#user_info_tosign").attr("href","http://www.smzdm.com/qiandao/")}}$("#user_info_tosign").removeClass("zhiyou_login");var channel=$("#channel").val();if(channel!="index"){var slogan=checkin.slogan;$(".scoreBox").after(slogan)}}if(is_anonymous&&1==is_anonymous){$("#comment_avatar").attr({src:no_avatar,alt:"匿名用户"}).unwrap("span").wrap('<a href="javascript:void(0);" class="userPic"></a>');$("#comment_avatar").parent(".userPic").after(' <span class="comment_nickName grey">匿名用户</span> ')}else{$("#comment_avatar").attr({src:avatarUrl,alt:nickname}).unwrap("span").wrap('<a href=" '+personLink+' " class="userPic" target="_blank" title=" '+nickname+' "></a>');$("#comment_avatar").parent(".userPic").after(' <a href=" '+personLink+' " class="comment_nickName a_underline" target="_blank"  title=" '+nickname+' ">'+nickname+"</a> ")}$(".comment_switch").show(function(){if(commentConnect&&$("#commentform").find(".check").length>0){$("#comments .comment_share i.check").addClass("icon-rightframe")}else if(commentConnect&&$("#commentform").find(".check").length>0){$("#comments .comment_share i.check").removeClass("icon-rightframe")}});if(unread["notice"]["num"]!="0"||unread["pm"]["num"]!="0"||unread["comment"]["num"]!="0"){var messageNum=parseInt(unread["notice"]["num"])+parseInt(unread["pm"]["num"]);if(messageNum!=0){var messageUrl=unread["notice"]["url"];if(parseInt(unread["notice"]["num"])<=0){messageUrl=unread["pm"]["url"]}$(".J_notice_message").attr("href",messageUrl).find("em").html(messageNum);if(messageNum>99){messageNum="99+"}$(".J_menu_message").attr("href",messageUrl).css("position","relative").html('我的消息<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else{$(".J_notice_message").hide()}if(unread["comment"]["num"]!=0){var commentUrl=unread["comment"]["url"];$(".J_notice_comment").attr("href",commentUrl).find("em").html(unread["comment"]["num"]);if(unread["comment"]["num"]>99){unread["comment"]["num"]="99+"}$(".J_menu_comment").attr("href",commentUrl).css("position","relative").html('我的评论<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else{$(".J_notice_comment").hide()}$(".J_notice").show().find(".z-icon-cross,.icon-cross-lighter").click(function(){$(".J_notice").hide()});$(".J_notice").slideDown("slow")}else{$(".J_notice").hide()}var num=resp.has_guanzhu_dongtai;num=+num;if(num>99){num="99+"}var html='<div id="focus-notice" class="J_focus_notice">'+'<i class="icon-cross-lighter" onclick=dataLayer.push({"event":"通用_关注浮层_关闭"})></i>'+'<a href="javascript:void(0)" target="_self">您有<span>'+num+"</span>条关注动态</a>"+"</div>";if(resp.has_guanzhu_dongtai!==0&&resp.has_guanzhu_dongtai!==undefined){$(".J_notice").css("top","75px");$(".nav-controls").append(html);$(".J_focus_notice").show();$(document).on("click",".J_focus_notice .icon-cross-lighter",function(){$(".J_focus_notice").hide();$(".J_notice").css("top","34px")});$("#focus-notice a").unbind().click(function(event){event.stopPropagation();dataLayer.push({event:"通用_关注浮层"});window.location.href="//www.smzdm.com#follow";if(!!$(".column-tab-name")[0]){$(".column-tab-name").find("li").eq(1).trigger("click")}})}$("#comment_tips").remove();$("#textareaComment").removeClass("zhiyou_login");$(".noLogin").removeClass("noLogin");var defaultText=$("#textareaComment").attr("default_data");$("#textareaComment").unbind("click").val(defaultText).focus(function(){if($(this).val()==defaultText){$(this).val("")}$(this).css("color","#666")}).blur(function(){if($(this).val()==""){$(this).val(defaultText).css("color","#ccc")}}).change(function(){$("#textCommentSubmit").removeAttr("disabled")});$("#textCommentSubmit").removeAttr("disabled").removeClass("btn_subGrey").addClass("btn_sub");var banright=resp.banright;if(banright.length>0){for(var i=0,len=banright.length;i<len;i++){if(banright[i]==1){var banMessage=resp.bantips;$("#textareaComment").html("").attr("disabled","disabled");$("#comment_error").html(banMessage).show();$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click");break}}}showHidenNotice(".login_Info","#chief_notice");showHidenNotice(".submission","#chief_notice");var loginError=parseInt(resp.login_error_num);if(loginError>=3){var source=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",source);$(".captcha_switch").show()}if(resp.close_comment_enter){$("#textareaComment").html("").attr("disabled","disabled");$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click")}if(resp.is_use_captcha){var source=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",source);$(".captcha_switch").show()}if(resp.bgm&&resp.bgm.permission&&resp.bgm.permission.commentpermission){init_action();$("#comment").append('<input type="hidden" readonly="readonly" id="is_bgm" name="is_bgm" value="1" />')}}else{zhiyou_relate.footer_login_layer_init()}return},set_checkin:function(){var me=this;$("#user_info_tosign").unbind("click");$.ajax({type:"get",url:zhiyou_relate.baseUrl+"user/checkin/jsonp_checkin",dataType:"jsonp",jsonp:"callback",success:function(resp){var error_code=resp.error_code;var error_msg=resp.error_msg;var data=resp.data;if(error_code==0){window.location.href="http://www.smzdm.com/qiandao/"}else{popUp("","#pop-status",error_msg["public"])}},error:function(){$("#user_info_tosign").bind("click",zhiyou_relate.set_checkin)}})},add_favorite:function(article_id,channel_id,obj){var me=this;if(window.location.protocol==="https:"){me.baseUrl=me.baseUrl.replace(/http/g,"https")}var favoriteUrl=me.baseUrl+"user/favorites/";$.ajax({type:"get",url:favoriteUrl+"jsonp_favorite",data:{article_id:article_id,channel_id:channel_id},dataType:"jsonp",jsonp:"callback",success:function(resp){var channel_map={3:"youhui",6:"news",11:"yuanchuang",7:"zhongce",8:"pingce",16:"2",31:"newbrand_topic"};if(resp.error_code==0){$("#pop-collect .pop_info_show a:first").attr("href",favoriteUrl+channel_map[channel_id]);popPosition("#pop-collect");$("#pop-collect").show();$("#cover").show();popClose("#pop-collect");$("a[id='collect_"+channel_id+"_"+article_id+"']").each(function(){$(this).attr("class","fav current");var favorite_num=Number($(this).find("em").html())+1;if(favorite_num<0){favorite_num=0}$(this).find("em").html(favorite_num)});popUp("","#pop-collect","")}else if(resp.error_code==2){$("#pop-nocollect .pop_info_show a:first").attr("href",favoriteUrl+channel_map[channel_id]);popPosition("#pop-nocollect");$("#pop-nocollect").show();$("#cover").show();popClose("#pop-nocollect");$("a[id='collect_"+channel_id+"_"+article_id+"']").each(function(){$(this).attr("class","fav");var favorite_num=Number($(this).find("em").html())-1;if(favorite_num<0){favorite_num=0}$(this).find("em").html(favorite_num)});popUp("","#pop-nocollect","")}else if(resp.error_code==5){me.popup_login_show()}else if(resp.error_code==6){}},error:function(){}})},init_favorite_by_cookie:function(){$(".fav").each(function(){var type=new Array([3,"youhui"],[6,"news"],[8,"test"],[7,"test_probation"],[11,"yuanchuang"],[16,"second"],[31,"newbrand_topic"]);var id=$(this).attr("id");if(typeof id!="undefined"){var idarr=id.split("_");var article_id=idarr[2];var atype=idarr[1];for(i=0;i<type.length;i++){var cook=getCookie("smzdm_collection_"+type[i][1]);var cookarr=[];if(cook){var cookarr=cook.split(",")}if(atype==type[i][0]&&$.inArray(article_id,cookarr)>-1){$(this).attr("class","fav current")}}}})},scored:function(id,currentStyle){var zan_box=$(id);if(zan_box.find("a").hasClass(currentStyle)){zan_box.mouseover(function(){$(this).find("."+currentStyle).css("display","none");$(this).find(".scoredInfo").css("display","block")});zan_box.mouseout(function(){$(this).find("."+currentStyle).css("display","block");$(this).find(".scoredInfo").css("display","none")})}},zhi_list_callback:function(resp,article_id,channel_id,rating,obj){if(rating==1){var worthy_obj=$("#rating_worthy_"+article_id);worthy_obj.find(" .scoreAnimate").fadeIn().animate({top:"-30px"},"normal").fadeOut(300);if(worthy_obj.find("em").length){var score=parseInt($.trim(worthy_obj.find("em").html()))}else{var scoreText=worthy_obj.find(" .scoreTotal").text();var scoreArr=scoreText.split(" ");var score=parseInt(scoreArr[1])}var score=score+1;if(worthy_obj.find(" .scoreTotal").length){worthy_obj.find(" .scoreTotal").html("<b>值</b> "+score)}else{worthy_obj.find("em").html(score)}}else{var unworthy_obj=$("#rating_unworthy_"+article_id);unworthy_obj.find(" .scoreAnimate").fadeIn().animate({top:"30px"},"normal").fadeOut(300);if(unworthy_obj.find(" .scoreTotal em").length>0){var score=parseInt($.trim(unworthy_obj.find(" .scoreTotal em").html()))}else{var scoreText=unworthy_obj.find(" .scoreTotal").text();var scoreArr=scoreText.split(" ");var score=parseInt(scoreArr[1])}var score=score+1;unworthy_obj.find(" .scoreTotal").html("<b>不值</b> "+score)}},zhi_detail_callback:function(resp,article_id,channel_id,rating,obj){var rating_obj=$("#rating_"+article_id),percentage;var n=parseInt($.trim($("#rating_worthy_num").text()));var m=parseInt($.trim($("#rating_unworthy_num").text()));if(rating==1){$(rating_obj).find(".add").show().animate({top:"-30px"},600).fadeOut("slow",function(){$("#rating_worthy_num").html(n+1);$("#rating_all_num").html("已有 "+(n+m+1)+" 用户参与")});percentage=(n+1)/(n+m+1)*100}else{$(rating_obj).find(".reduce").show().animate({top:"80px"},600).fadeOut("slow",function(){$("#rating_unworthy_num").html(m+1);$("#rating_all_num").html("已有 "+(n+m+1)+" 用户参与")});percentage=n/(n+m+1)*100}rating_obj.find(" .progressing").css("width",percentage.toString()+"%")},zan_callback:function(resp,article_id,channel_id,rating,obj){var me=this;$(obj).find("span.addNumber").fadeIn().animate({top:"-35px"},"normal").fadeOut(300);$(obj).attr("class","zan current");zhiyou_relate.scored("#details-zan","current");if($(obj).find("em").length>0){$(obj).find("span.scoreAnimate").fadeIn().animate({top:"-35px"},"normal").fadeOut(300,function(){$(obj).find("em").html(Number($(obj).find("em").html())+1)})}else{if($(obj).parents(".show_exp_zan").find("em").length>0){$(obj).parents(".show_exp_zan").find("em").html(Number($(obj).parents(".show_exp_zan").find("em").html())+1)}else{$(obj).parents(".show_exp_zan").find(".grey").html("已有<em>1</em>人赞过")}}},add_rating:function(type,article_id,channel_id,rating,obj){var me=this;if(type=="zan"){var callback=me.zan_callback;$(obj).removeAttr("onclick");$(obj).css("cursor","default")}else if(type=="zhi_list"){var callback=me.zhi_list_callback;var worthy_obj=$("#rating_worthy_"+article_id);var unworthy_obj=$("#rating_unworthy_"+article_id);worthy_obj.removeAttr("onclick").css("cursor","default");unworthy_obj.removeAttr("onclick").css("cursor","default");if(rating==1){worthy_obj.addClass("current").addClass("worthCurrent");unworthy_obj.addClass("unworthCurrent")}else{worthy_obj.addClass("worthCurrent");unworthy_obj.addClass("current").addClass("unworthCurrent")}}else if(type=="zhi_in"){var callback=me.zhi_detail_callback;var rating_obj=$("#rating_"+article_id);var worthy_obj=$("#rating_worthy");var unworthy_obj=$("#rating_unworthy");worthy_obj.removeAttr("onclick").css("cursor","default").addClass("worthCurrent");unworthy_obj.removeAttr("onclick").css("cursor","default").addClass("unworthCurrent");zhiyou_relate.scored("#details-zhi","worthCurrent");zhiyou_relate.scored("#details-buzhi","unworthCurrent")}if(window.location.protocol==="https:"){me.baseUrl=me.baseUrl.replace(/http/g,"https")}$.ajax({type:"get",url:me.baseUrl+"user/rating/jsonp_add",data:{article_id:article_id,channel_id:channel_id,rating:rating},dataType:"jsonp",jsonp:"callback",success:function(resp){callback(resp,article_id,channel_id,rating,obj)},error:function(){}})},init_rating_by_cookie:function(){var channel_map=[0,3,6,7,8,9,10,11,16];for(var i=1,len=channel_map.length;i<len;i++){var channel_id=channel_map[i];var rating_key="smzdm_rating_"+channel_id;var rating_cookie_json=getCookie(rating_key);if(rating_cookie_json){rating_cookie=json_decode(rating_cookie_json);if(channel_id==3){if($(".lrBot").length){$(".lrBot").each(function(){if(typeof $(this).find(" .good").attr("id")!="undefined"){var article_id=$(this).find(" .good").attr("id").split("_")[2];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy_"+article_id);if(worthy_obj.length>0){var unworthy_obj=$("#rating_unworthy_"+article_id);worthy_obj.removeAttr("onclick");unworthy_obj.removeAttr("onclick");if(rating_cookie[article_id]==1){worthy_obj.addClass("current").css("cursor","default").addClass("worthCurrent");unworthy_obj.css("cursor","default").addClass("unworthCurrent")}else if(rating_cookie[article_id]==-1){worthy_obj.css("cursor","default").addClass("worthCurrent");unworthy_obj.addClass("current").css("cursor","default").addClass("unworthCurrent")}}}}})}if($(".zan_fav_com").length){$(".zan_fav_com").each(function(){if(typeof $(this).find(" .zan").attr("id")!="undefined"){var article_id=$(this).find(" .zan").attr("id").split("_")[2];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy_"+article_id);if(worthy_obj.length>0){worthy_obj.removeAttr("onclick");if(rating_cookie[article_id]==1){worthy_obj.addClass("current").css("cursor","default")}}}}})}$(".score_rateBox").each(function(){if(typeof $(this).attr("id")!="undefined"){var article_id=$(this).attr("id").split("_")[1];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy");if(worthy_obj.length>0){var unworthy_obj=$("#rating_unworthy");worthy_obj.removeAttr("onclick").css("cursor","default");unworthy_obj.removeAttr("onclick").css("cursor","default");worthy_obj.addClass("worthCurrent");unworthy_obj.addClass("unworthCurrent");scored("#details-zhi","worthCurrent");scored("#details-buzhi","unworthCurrent")}}}})}else{$(".zan").each(function(){var id=$(this).attr("id");if(typeof id!="undefined"){var idarr=id.split("_");var article_id=idarr[3];var select_channel_id=idarr[2];if(channel_id==select_channel_id&&article_id in rating_cookie){$(this).attr("class","zan current");$(this).removeAttr("onclick");$(this).css("cursor","default")}}})}}}}};zhiyou_relate.setCookie=function(cookieName,cookieValue,seconds,path,domain,secure){seconds=seconds?seconds:604800;seconds=seconds*1e3;var expires=new Date;expires.setTime(expires.getTime()+seconds);document.cookie=encodeURIComponent(cookieName)+"="+encodeURIComponent(cookieValue)+(expires?"; expires="+expires.toGMTString():"")+(path?"; path="+path:"/")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return};zhiyou_relate.footer_login_layer_init=function(){var ele=".footer_login_layer";var login_layer_show_gtm=$(ele).data("login_layer_show_gtm"),click_login_gtm=$(ele).data("click_login_gtm"),click_register_gtm=$(ele).data("click_register_gtm"),click_close_gtm=$(ele).data("click_close_gtm");var footer_ele="#footer_layer";var cookie_name="has_show_login_layer";var footer_layer_tpl='<div class="footer-layer" id="footer_layer" style="display:none">'+'<div class="layer-center">'+'<div class="layer-left">'+"<ul>"+'<li><img src="http://res.smzdm.com/images/zhiyou/material/footer_login_layer.png"/></li>'+"<li><button class=\"Login zhiyou_login\" onclick=\"dataLayer.push({'event':'"+click_login_gtm+"'})\">登录</button></li>"+"<li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');dataLayer.push({'event':'"+click_register_gtm+"'})\" >注册</button></li>"+"</ul>"+"</div>"+'<div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="dataLayer.push({\'event\':\''+click_close_gtm+"'})\"></i></div>"+"</div>"+"</div>";var has_show_login_layer=getCookie(cookie_name);var url_suf=window.location.hash;var url_hostname=window.location.hostname;var url_pathname=window.location.pathname;var layer_pre="详情页";switch(url_hostname){case"news.smzdm.com":layer_pre="资讯详情";break;case"post.smzdm.com":layer_pre="原创详情";break;case"wiki.smzdm.com":layer_pre="百科详情";break;case"2.smzdm.com":layer_pre="二手详情";break;case"www.smzdm.com":if(0==url_pathname.indexOf("/zhuanti/")){layer_pre="专题详情"}else{layer_pre="优惠详情"}break;case"test.smzdm.com":if(0==url_pathname.indexOf("/pingce/p")){layer_pre="评测详情"}else{layer_pre="众测详情"}break}var c_login_tongji="dataLayer.push({'event':'"+layer_pre+"_评论_浮层登录'});";var c_register_tongji="dataLayer.push({'event':'"+layer_pre+"_评论_浮层注册'});";var c_close_tongji="dataLayer.push({'event':'"+layer_pre+"_评论_浮层关闭'});";var zt_title=$("#footer_nologin_comment_layer").data("title");if(zt_title&&typeof zt_title!="undefined"){c_login_tongji="ga('send', 'event', '专题活动', '"+zt_title+"_评论浮层', '登录');";c_register_tongji="ga('send', 'event', '专题活动', '"+zt_title+"_评论浮层', '注册');";c_close_tongji="ga('send', 'event', '专题活动', '"+zt_title+"_评论浮层', '关闭');"}var footer_comment_layer_tpl='<div class="footer-layer" id="footer_layer" style="display:none">'+'<div class="layer-center">'+'<div class="layer-left">'+"<ul>"+'<li><img src="//res.smzdm.com/images/zhiyou/material/footer_comment_login_layer.png"/></li>'+'<li><button class="Login zhiyou_login" onclick="'+c_login_tongji+'">登录</button></li>'+"<li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');"+c_register_tongji+'" >注册</button></li>'+"</ul>"+"</div>"+'<div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="'+c_close_tongji+'"></i></div>'+"</div>"+"</div>";if(has_show_login_layer=="1"){return false}if($(ele).length<=0){if(0==url_suf.indexOf("#comments")){show_tpl(footer_comment_layer_tpl,2)}return}show_tpl(footer_layer_tpl,1);function show_tpl(tpl,type){if(typeof $(footer_ele)!="undefined"&&$(footer_ele)&&$(footer_ele).length>=0){$(footer_ele).remove()}$("#footer").after(tpl);if(1==type&&typeof dataLayer!="undefined"){dataLayer.push({event:"virtualPageview",page:login_layer_show_gtm})}if(2==type&&typeof ga!="undefined"){if(zt_title&&typeof zt_title!="undefined"){ga("send","event","专题活动",zt_title+"_评论浮层","展现")}else{ga("send","event","专题活动","专题活动_评论浮层","展现")}}$(footer_ele).show();$(".close_footer_layer").click(function(){var that=$(this);$(footer_ele).hide();zhiyou_relate.setCookie(cookie_name,"1",604800,"/",".smzdm.com")})}};zhiyou_relate.init();zhiyou_relate.extra_user_info_callback=function(resp){};var smzdm_domain=".smzdm.com";var comment_report_cookiename="comment_report";window.comment_report_cookie_list;var comment_rating_cookiename="comment_rating";window.comment_rating_cookie_list;var StringBuilder=function(d){this.s=new Array(d);this.onMultiAppendBeforeHandle=null;this.onMultiAppendBefore=function(param){this.onMultiAppendBeforeHandle=param;return this};this.append=function(d){this.s.push(d);return this};this.toString=function(){return this.s.join("")};this.clear=function(){this.s=new Array};this.appendMultiFormat=function(format_str,data){if(typeof data=="object"){for(var i in data){if(this.onMultiAppendBeforeHandle!=null)this.onMultiAppendBeforeHandle(data[i]);this.appendFormat(format_str,data[i])}}return this};this.appendFormat=function(){var n=arguments.length;if(n==0)return this;var f=arguments[0];if(n==1)return this.append(f);var arg=arguments[1];if(arg==null)arg="";var i,e,c,k,akFun;if(typeof arg=="object")akFun=function(a,k){return a[1][k]};else akFun=function(a,k){return a[k-0+1]};for(i=0;i<f.length;){c=f.charAt(i);if(c=="{"){e=f.indexOf("}",i);k=f.substring(i+1,e);this.s.push(akFun(arguments,k));i=e+1;continue}this.s.push(c);i++}return this}};function popPosition(o){var wrapWidth=$(window).width();var wrapHeight=$(window).height();var oWidth=$(o).width();var oHeight=$(o).height();$(o).css({left:wrapWidth/2-oWidth/2,top:wrapHeight/2-oHeight/2})}$.fn.autoTextarea=function(options){if($("#quickReply")){var defaults={maxHeight:null,minHeight:$(this).height()};var opts=$.extend({},defaults,options);$(this).bind("paste cut keydown keyup focus blur",function(){var height,style=this.style;this.style.height=opts.minHeight+"px";var padding_top_obj=$(this).css("padding-top").split("",1);var padding_top=parseInt(padding_top_obj);if(this.scrollHeight>opts.minHeight){if(opts.maxHeight&&this.scrollHeight>opts.maxHeight){height=opts.maxHeight-padding_top;style.overflowY="scroll"}else{height=this.scrollHeight-padding_top;style.overflowY="hidden"}style.height=height-padding_top+"px"}})}};function json_encode(mixed_val){var json=this.window.JSON;if(typeof json==="object"&&typeof json.stringify==="function"){return json.stringify(mixed_val)}var value=mixed_val;var quote=function(string){var escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'};var str=function(key,holder){var gap="";var indent="    ";var i=0;var k="";var v="";var length=0;var mind=gap;var partial=[];var value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}};return str("",{"":value})}function json_decode(str_json){var json=this.window.JSON;if(typeof json==="object"&&typeof json.parse==="function"){return json.parse(str_json)}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var j;var text=str_json;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return j}throw new SyntaxError("json_decode")}function getCookie(name){var cookie_start=document.cookie.indexOf(name);var cookie_end=document.cookie.indexOf(";",cookie_start);var val=document.cookie.substring(cookie_start+name.length+1,cookie_end>cookie_start?cookie_end:document.cookie.length);return cookie_start==-1?"":decodeURIComponent(val)}function setCookie(cookieName,cookieValue,seconds,path,domain,secure){seconds=seconds?seconds:604800;seconds=seconds*1e3;var expires=new Date;expires.setTime(expires.getTime()+seconds);document.cookie=encodeURIComponent(cookieName)+"="+encodeURIComponent(cookieValue)+(expires?"; expires="+expires.toGMTString():"")+(path?"; path="+path:"/")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return}function setCookieArr1(cookieName,data,seconds,path,domain,secure){var result_json=getCookie(cookieName);var one_list;if(result_json){one_list=json_decode(result_json)}if(one_list){var one_list_length=one_list.length;if(one_list_length>=cookie_length_limit){var temp_list=new Array;one_list[cookie_length_limit]=data;for(var i in one_list){if(i<=one_list_length-1){var j=parseInt(i)+1;temp_list[i]=one_list[j.toString()]}}one_list=temp_list}else{one_list[one_list_length]=data}}else{var one_list=new Array;one_list[0]=data}var cookie_list_json=json_encode(one_list);seconds=seconds?seconds:604800;setCookie(cookieName,cookie_list_json,seconds,path,domain,secure);return}function getBooInCookieArr1(cookieName,data){var result_json=getCookie(cookieName);if(result_json){var one_list=json_decode(result_json);if(one_list){for(var i in one_list){if(one_list[i]&&one_list[i]==data){return true}}}}return false}function setCookieArr2(cookieName,param1,param2,seconds,path,domain,secure){var result_json=getCookie(cookieName);var two_list;if(result_json){two_list=json_decode(result_json)}if(two_list){var two_list_length=two_list.length;if(two_list_length>=cookie_length_limit){var temp_list=new Array;two_list[cookie_length_limit]=new Array;two_list[cookie_length_limit][0]=param1;two_list[cookie_length_limit][1]=param2;for(var i in two_list){if(i<=two_list_length-1){var j=parseInt(i)+1;temp_list[i]=two_list[j.toString()]}}two_list=temp_list}else{two_list[two_list_length]=new Array;two_list[two_list_length][0]=param1;two_list[two_list_length][1]=param2}}else{var two_list=new Array;two_list[0]=new Array;two_list[0][0]=param1;two_list[0][1]=param2}var cookie_list_json=json_encode(two_list);seconds=seconds?seconds:604800;setCookie(cookieName,cookie_list_json,seconds,path,domain,secure);return}function getBooInCookieArr2(cookieName,data){var result_json=getCookie(cookieName);if(result_json){var two_list=json_decode(result_json);if(two_list){for(var i in two_list){if(two_list[i]&&two_list[i][0]&&two_list[i][0]==data){return true}}}}return false}function deleteCookie(name){var cookieVal=getCookie(name);setCookie(name,cookieVal,-1*(new Date).getTime()/1e3,"/");setCookie(name,cookieVal,-1*(new Date).getTime()/1e3,"/",HIS_DOMAIN)}function deleteCookieInArr(name,value){var getCookieValue=getCookie(name);if(getCookieValue!==""){var cookieArr=getCookieValue.split(",");if($.inArray(""+value,cookieArr)!==-1){cookieArr.splice($.inArray(""+value,cookieArr),1);setCookie(name,cookieArr.join(","),-1*(new Date).getTime()/1e3,"/");setCookie(name,cookieArr.join(","),null,"/",HIS_DOMAIN)}}}function setCookieInArr(name,value,seconds,path,domain,secure){var getCookieValue=getCookie(name);if(getCookieValue!==""){var cookieArr=getCookieValue.split(",");if($.inArray(""+value,cookieArr)==-1){cookieArr.push(value);setCookie(name,cookieArr.join(","),seconds,path,domain,secure)}}else{setCookie(name,value,seconds,path,domain,secure)}}$(function(){showHide(".downloadApp","",".more-share-box");document.onkeydown=function(moz_ev){var ev=null;if(window.event){ev=window.event}else{ev=moz_ev}if(ev!=null&&ev.ctrlKey&&ev.keyCode==13){var quick_isFocus=$("#quickComment").is(":focus");var comment_isFocus=$("#textareaComment").is(":focus");var choujiang_isFocus=$("#choujiangComment").is(":focus");if(true==comment_isFocus){$("#textCommentSubmit").click()}if(true==quick_isFocus){$("#textCommentSubmitQuick").click()}if(true==choujiang_isFocus){$("#choujiangCommentSubmit").click()}}};commentQuickReply(".reply");visibleOrNot(".operate_box",".noGoods","visibility");visibleOrNot("blockquote",".comment_action","display");try{if(tab&&typeof tab==="function"){tab(".tab_comment_li",".tab_info","current_item","click")}}catch(e){}openClose(".seaAll","","comments");openClose("a.more","a.pickup","mallNav");$("#textareaComment, .comment_tips").addClass("zhiyou_login");comment_share_to_sina("i.check");$(".textarea_quick").height("auto");var quickComment_obj=$("#quickComment");if(quickComment_obj.length){quickComment_obj.val("");quickComment_obj.autoTextarea({maxHeight:200})}var ok_txt="评论成功，稍后在页面中显示。每日前三条评论还加经验哦！";var txt3='"><i class="icon-loginright"></i> '+ok_txt,txt4='"><i class="icon-loginright"></i> '+ok_txt,txt5='"><i class="icon-loginright"></i> 为维护良好讨论环境，新注册用户的评论需人工审核后再显示，请谅解',txt8='"><i class="icon-loginright"></i> <span class="red">你的投票已超过次数限制或未达到投票权限，该评论仅作为普通评论</span>',txt10='评论同步新浪微博失败，您尚未绑定微博账号，<span class="red" id="goback">4</span>秒后将带您进入微博授权页',$submit=$("#commentform #textCommentSubmit"),$submitQuickBtn=$("#commentquickform #textCommentSubmitQuick");$submit.attr("disabled",false);$submitQuickBtn.attr("disabled",false);var strLen=function(s){var w=0;for(var i=0;i<s.length;i++){var c=s.charCodeAt(i);if(c>=1&&c<=126||65376<=c&&c<=65439){w++}else{w+=2}}return w};$("#commentform").submit(function(){if($.trim($("#textareaComment").val())==""||$.trim($("#textareaComment").val())==$("#textareaComment").attr("default_data")){if($("#error").is(":hidden")){$("#error").html("您是不是忘了说点什么？").css("color","#f04848").slideDown().delay(3e3).slideUp()}}else if(strLen($.trim($("#textareaComment").val()))>1e3){if($("#error").is(":hidden")){$("#error").html("评论内容不能多于1000个字符").css("color","#f04848").slideDown().delay(3e3).slideUp()}}else{submit_comment(0)}return false});$("#commentquickform").submit(function(){if($.trim($("#quickComment").val())==""||$.trim($("#quickComment").val())==$("#textareaComment").attr("default_data")){if($("#quick_error").is(":hidden")){$("#quick_error").html("您是不是忘了说点什么？").css("color","#f04848").slideDown().delay(3e3).slideUp()}}else if(strLen($.trim($("#quickComment").val()))>1e3){if($("#quick_error").is(":hidden")){$("#quick_error").html("评论内容不能多于1000个字符").css("color","#f04848").slideDown().delay(3e3).slideUp()}}else{submit_comment(1)}return false});var _time_slicing=10;var wait=_time_slicing,submit_val=$submit.html(),waitquick=_time_slicing,quick_submit_val=$submitQuickBtn.html();function countdown(){if(wait>0){$submit.html(wait);wait--;setTimeout(countdown,1e3)}else{$submit.html(submit_val).attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);wait=_time_slicing}}function quickcountdown(){if(waitquick>0){$submitQuickBtn.html(waitquick);waitquick--;setTimeout(quickcountdown,1e3)}else{$submitQuickBtn.html(quick_submit_val).attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);waitquick=_time_slicing}}function count_down(obj){var secs=parseInt($(obj).html());if(secs>0){$(obj).html(secs-1);setTimeout(function(){count_down(obj)},1e3)}if(secs==0){$(".sub_Success").fadeOut();$("#cover").fadeOut()}}function submit_comment(isQuickSumit){var errorContainerId="error";var btn=$submit;var loadingImg=$("#loading");if(1==isQuickSumit){var formObj=$("#commentquickform");errorContainerId="quick_error";btn=$submitQuickBtn;loadingImg=$("#loadingquick")}else{var formObj=$("#commentform")}btn.attr("disabled",true).removeClass("btn_sub").addClass("btn_subGrey").fadeTo("slow",1);loadingImg.show();$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_set_comment",data:formObj.serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);loadingImg.hide();if(10==result.error_code){if(result.error_msg.sina_uri){$("#pop-status-fail").find(".pop_info").html(txt10);$("#pop-status-fail").find(".icon-logintanhao").css({float:"left","margin-left":"15px","margin-top":"15px"});$("#pop-status-fail").fadeIn();$("#cover").fadeIn();popPosition("#pop-status-fail");count_down("#goback");setTimeout(function(){window.location.href=result.error_msg.sina_uri},4e3)}else{setTimeout(function(){btn.attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);$("#"+errorContainerId).slideUp()},3e3)}return}else if(0==result.error_code){var div_new=$(".comment_wrap .tab_nav").find(".tab_comment_li:first");div_new.siblings().removeClass("current_item");div_new.addClass("current_item");$("#commentTabBlockNew").css("display","");$("#commentTabBlockHot").css("display","none");if(result.error_msg.sina_uri){window.location.href=result.error_msg.sina_uri;return}var the_floor=0;var floor_grey=$("#commentTabBlockNew ul.comment_listBox li:first .grey").html();if(floor_grey)the_floor=floor_grey.split("楼")[0];the_floor?the_floor=parseInt(the_floor)+1:the_floor=0;var ok_htm='\n<div id="success_1'+txt3+"</div>\n";if(6==result.error_code){ok_htm='\n<div id="success_1'+txt4+"</div>\n"}else if(8==result.error_code){ok_htm='\n<div id="success_1'+txt8+"</div>\n"}var new_comment_html="";new_comment_html+='<li id="li_comment_4700621" class="comment_list">';new_comment_html+='<div class="comment_avatar">';new_comment_html+='<a href="javascript:void(0);" class="userPic"><img src="'+result.error_msg.head+'" width="36" height="36"/></a>';new_comment_html+=the_floor?'<span class="grey">'+the_floor+"楼</span>":"";new_comment_html+="</div>";new_comment_html+='<div class="comment_conBox">';new_comment_html+='<div class="comment_avatar_time"><div class="time">'+result.error_msg.format_date+"</div>";if(result.error_msg.is_anonymous){new_comment_html+='<span class="grey">'+result.error_msg.display_name+"</span>"}else{new_comment_html+='<a href="javascript:void(0);" class="a_underline user_name">'+result.error_msg.display_name+"</a>"}new_comment_html+="</div>";new_comment_html+='<div class="comment_conWrap">';new_comment_html+='<div class="comment_con"><p>'+result.error_msg.comment_content+"</p></div>";new_comment_html+=ok_htm;new_comment_html+='<div class="blankDiv"></div>';new_comment_html+="</div>";new_comment_html+="</div>";new_comment_html+='<div class="clear"></div>';new_comment_html+="</li>";$("#comment .tab_nav:first").css("display","block");$("#li_comment_new").after(new_comment_html);setTimeout(function(){$("#success_1").remove()},3e3);if(1==isQuickSumit){quickcountdown()}else{countdown()}if(1==isQuickSumit){$("#quickComment").val("")}else{$("#textareaComment").val("")}cancle_vote();$(".commentNum").each(function(){$(this).html(parseInt($(this).html())+1)});$("#quickComment").height("auto");var score=result.error_msg.post_points?result.error_msg.post_points:0;var exp=result.error_msg.post_experience?result.error_msg.post_experience:0;var gold=result.error_msg.post_gold?result.error_msg.post_gold:0;var mana=result.error_msg.post_prestige?result.error_msg.post_prestige:0;if(score!=0||exp!=0||gold!=0||mana!=0){var scoreDom=score==0?"":'<span class="comment_score">积分：<em>'+score+"</em></span>";var expDom=exp==0?"":'<span class="comment_exp">经验：<em>'+exp+"</em></span>";var goldDom=gold==0?"":'<span class="comment_gold">金币：<em>'+gold+"</em></span>";var manaDom=mana==0?"":'<span class="comment_mana">威望：<em>'+mana+"</em></span>";$("#pop-comment-score").find(".pop_comment_info").html(scoreDom+expDom+goldDom+manaDom);popUp("","#pop-comment-score","成功发表评论")}if($("#"+errorContainerId).is(":hidden")){$("#"+errorContainerId).html(ok_txt).css("color","green").slideDown().delay(3e3).slideUp()}}else if(7==result.error_code){var msg=result.error_msg;$("body").append('<div class="pop pop_no_title" id="pop-scorenotenough"><i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i><div class="pop-content oneLine"><i class="icon-logintanhao"><!--[if lt IE 8]>404<![endif]--></i><p class="pop_info"></p></div></div>');popUp("","#pop-scorenotenough",msg)}else if(19==result.error_code){showCommentBind(result.error_code,formObj.serialize(),isQuickSumit);return}else if(20==result.error_code){showCommentBind(result.error_code,formObj.serialize(),isQuickSumit);return}else{var no_htm=result.error_msg;if(5==result.error_code){no_htm="请登录后发表评论"}$("#"+errorContainerId).slideDown().html(no_htm);setTimeout(function(){btn.attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);$("#"+errorContainerId).slideUp()},3e3)}}})}func_atta();func_report()});function showCommentBind(errorCode,postData,isQuickSumit){zhiyou_relate.popup_login_show();$("#zhiyou_login_window_iframe").attr("src","https://zhiyou.smzdm.com/user/mobile/window/");var $commentPop=$("#pop-login-new .pop-close").addClass("J_comment_pop").off("click");if(errorCode===19){$(document).on("click",".J_comment_pop, #cover",function(){$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_set_comment?submit_num=2",data:postData,dataType:"jsonp",jsonp:"callback",success:function(data){window.location.reload()},error:function(error){console.log(error)}})})}if(window.addEventListener){window.addEventListener("message",function(e){if(e.origin!=="https://zhiyou.smzdm.com")return;var data=JSON.parse(e.data);if(data.conType===1){$(".J_comment_pop").click();if(isQuickSumit){$("#textCommentSubmitQuick").removeAttr("disabled").click()}else{$("#textCommentSubmit").removeAttr("disabled").click()}}},false)}else{if(window.attachEvent){window.attachEvent("onmessage",function(e){if(e.origin!=="https://zhiyou.smzdm.com")return;var data=JSON.parse(e.data);if(data.conType===1){$(".J_comment_pop").click();if(isQuickSumit){$("#textCommentSubmitQuick").removeAttr("disabled").click()}else{$("#textCommentSubmit").removeAttr("disabled").click()}}})}}}function limitKeyup(that){var val=$(that).val().length;if(val>=1e3){$(that).val($(that).val().substring(0,1e3))}}function showHide(obj,newClass,subBlock){$(document).on("mouseover",obj,function(){$(this).addClass(newClass);$(this).find(subBlock).show()});$(document).on("mouseout",obj,function(){$(obj).removeClass(newClass);$(obj).find(subBlock).hide()})}function openClose(openObj,closeObj,method){if(method=="mallNav"){$(openObj).click(function(){$(this).prev().css("height","auto");$(this).hide();$(this).next("a").show()});$(closeObj).click(function(){$(this).parent().find("ul").css("height","64px");$(this).hide();$(this).prev("a").show()})}else if(method=="comments"){var blockquoteNum=$("blockquote").length;for(var i=0;i<blockquoteNum;i++){var maxHeight=$(openObj).prev(".comment_con").eq(i).height();if($(openObj).prev(".comment_con").eq(i).height()==120){$(openObj).eq(i).css("display","block")}else{$(openObj).eq(i).css("display","none")}}$(openObj).click(function(){$(this).prev().css({height:"auto","max-height":"100%"});$(this).hide();$(this).next("a").show()})}}function init_action(){if($("#comments .tab_info .comment_listBox").length>0){$(".comment_listBox li.comment_list, .comment_listBox li.comment_list blockquote").each(function(){var commentID=$(this).attr("blockquote_cid");var userID=$(this).find(".user_name:first").attr("usmzdmid");if($(this).hasClass("comment_list")){var commentIdArray=$(this).attr("id").split("_");commentID=commentIdArray[commentIdArray.length-1]}var mosaicDom='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+commentID+')">打码</a>';var blackListDom='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+userID+'" title="关小黑屋" target="_blank">关小黑屋</a>';if(userID==0||userID==undefined){blackListDom=""}var deleteDom='<a href="javascript:void(0);" onclick="delete_comment_confirm('+commentID+')" title="删除">删除</a>';var editDom='<a href="http://comments.bgm.smzdm.com/comments/info/'+commentID+'" title="编辑" target="_blank">编辑</a>';var controls=mosaicDom+blackListDom+deleteDom+editDom;$(this).find(".dingNum:last").before(controls)})}}function func_atta(obj_name){if(!obj_name||typeof obj_name==undefined){obj_name="#comment"}$(obj_name+" .atta").click(function(){if(parseInt($("#log_status").val())!=1){zhiyou_relate.popup_login_show()}else{$(window).scrollTop($("#comments").offset().top-50);var textcomment_obj=$("#textareaComment");if(textcomment_obj.length>0){var author=$(this).attr("title");var output=$.trim(textcomment_obj.val());var default_data=$.trim($("#textareaComment").attr("default_data"));if(output==default_data){output=author+" "}else{var out_arr=output.split(" ");var flag=true;for(i=0;i<out_arr.length;i++){if(author==out_arr[i]){flag=false;break}}if(flag){output=author+" "+output+" "}else{output+=" "}}textcomment_obj.focus().val(output);return true}}return true})}function func_report(obj_name){if(!obj_name||typeof obj_name==undefined){obj_name="#comment"}$(obj_name+" .jubao").each(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var result_json=getCookie(comment_report_cookiename);if(result_json){var comment_report_cookie_list=json_decode(result_json);if(comment_report_cookie_list){for(var i in comment_report_cookie_list){if(comment_report_cookie_list[i]&&comment_report_cookie_list[i]==report_cid){has_report_omment(report_cid)}}}}}}).click(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie){setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！");return false}var report_type=1;var report_text="";popPosition("#pop-report");var $popReport=$("#pop_report_opinion"),$popSubmit=$("#pop_report_submit");$popReport.find("textarea").val("").end().hide();$popSubmit.removeAttr("disabled").removeClass().addClass("btn_login");$("#pop-report").show(function(){$(this).find("input[type='radio']").removeAttr("checked").click(function(){var n=$(this).attr("id").split("_")[2];report_type=n;if(n==9){$popReport.find("textarea").val("").end().show();$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey");$popReport.find("textarea").bind("keyup mouseup",function(){var len=$(this).val().length;report_text=$popReport.find("textarea").val();if(len>=2){$popSubmit.removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}else{$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey")}})}else{report_text="";if($popReport.is(":visible")){$popReport.hide();$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}}})});$("#cover").show();popClose("#pop-report");$("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide();$("#pop_report_opinion").hide();$("#pop_report_opinion").find("textarea").val("");$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_comment_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0==result.error_code){has_report_omment(report_cid);setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-success","举报成功！")}else{if(result.error_msg){popUp("","#pop-status-fail",result.error_msg)}else{popUp("","#pop-status-fail","举报失败！")}}return},error:function(){popUp("","#pop-status-fail","网络错误")}})});return}})}function commentReport(commentid,obj){var span_aid=obj.attr("id");if(!span_aid||span_aid==undefined||typeof span_aid==undefined){return}var report_cid=span_aid.split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie){setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！");return false}var report_type=1;var report_text="";popPosition("#pop-report");$("#pop-report").css({position:"fixed",top:"50%",left:"50%","margin-left":"-240px","margin-top":"-165px"}).show(function(){$("#pop_report_opinion").hide();$(this).find("input[type='radio']").removeAttr("checked").click(function(){var n=$(this).attr("id").split("_")[2];report_type=n;if(n==9){$("#pop_report_opinion").show();$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey");$("#pop_report_opinion").find("textarea").show().bind("keyup mouseup",function(){var len=$(this).val().length;report_text=$("#pop_report_opinion").find("textarea").val();if(len>=10){$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}else{$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey")}})}else{report_text="";if($("#pop_report_opinion").is(":visible")){$("#pop_report_opinion").hide().find("textarea").hide();$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}}})});$("#cover").show();popClose("#pop-report");$("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide();$("#pop_report_opinion").hide();$("#pop_report_opinion").find("textarea").val("");$(this).attr("disabled","disabled").addClass("btn_grey");$(".pop_report_opinion p").html("最少输入10个字").attr("class","grey");$.ajax({type:"POST",url:"/user/comment/ajax_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"json",success:function(data){$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");var result=eval(data);if(0==result.error_code){has_report_omment(report_cid);$("#report_"+report_cid).removeAttr("onclick").html("已举报");setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-success","举报成功！")}else{if(result.error_msg){popUp("","#pop-status-fail",result.error_msg)}else{popUp("","#pop-status-fail","举报失败")}}return},error:function(){popUp("","#pop-status-fail","网络错误")}});$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");return false});return false}function has_report_omment(id){$("#comment .tab_info .comment_listBox li #report_"+id).removeAttr("onclick").addClass("comment-report").html("已举报");return}function get_rating_num(licid,cid,isding){var numID="cdc_support_"+cid;if(0==isding){numID="cdc_oppose_"+cid}var rs=$("#li_comment_"+licid+" #"+numID+":first span").html();if(rs){var st=rs.split("(")[1];rs=st.split(")")[0];rs?rs=parseInt(rs):rs=0}else{rs=0}return rs}function has_rating_omment(id,isding,dingnum,cainum){if(1==isding){$("#comment .tab_info .comment_listBox li #cdc_support_"+id).removeAttr("onclick").addClass("current").html("顶<span>("+dingnum+")</span>");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+id).removeAttr("onclick").removeClass("current")}else{$("#comment .tab_info .comment_listBox li #cdc_support_"+id).removeAttr("onclick").removeClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+id).removeAttr("onclick").addClass("current").html("踩<span>("+cainum+")</span>")}return}function init_smile(){var smilePageCount;var smilePageDom="";if(typeof smileJSON!=="undefined"&&smileJSON.length){smilePageCount=smileJSON.length;for(var i=0,iTemp=smileJSON.length;i<iTemp;i++){if(!smileJSON.hasOwnProperty(i)||!smileJSON[i]){continue}var smileDom="";for(var j=0,jTemp=smileJSON[i].length;j<jTemp;j++){if(!smileJSON[i].hasOwnProperty(j)||!smileJSON[i][j]){continue}smileDom+='<li><a href="javascript:void(0)" class="'+smileJSON[i][j][0]+'" default-data="['+smileJSON[i][j][1]+']" title="'+smileJSON[i][j]["1"]+'"></a></li>'}$('<ul class="smileBox" '+(i+1!==1?'style="display:none;"':"")+"></ul>").append(smileDom).appendTo(".smileLayerBg");smilePageDom+='<a href="javascript:void(0)"'+(i+1===1?' class="current"':"")+">"+(i+1)+"</a>"}$('<div class="smilePage"></div>').append(smilePageDom).appendTo(".smileLayerBg")}var default_data=$.trim($("#textareaComment").attr("default_data"));$(".icon-small").click(function(){$(".smileLayerBg").hide();if($(this).attr("isclick")=="1"){$(this).removeAttr("isclick")}else{$(".icon-small").each(function(){$(this).removeAttr("isclick")});$(this).attr("isclick","1");var layerP=$(this).parent();layerP.find(".smileLayerBg").show();layerP.find(".smileLayerBg .smileBox").hide().eq(0).show();layerP.find(".smileLayerBg .smilePage a").removeAttr("class").eq(0).attr("class","current")}});$(document).on("click",".smilePage a",function(){$(this).addClass("current").siblings().removeClass("current");$(".smileBox").hide().eq($(".smilePage a").index(this)).show()});$(document).on("click",".smileLayerBg li a",function(){var temp_div=$(this).parents(".comment_smileBox");var textarea_obj=temp_div.parent().parent().find("textarea:first");temp_div.find(".smileLayerBg").css("display","none");temp_div.find(".icon-small").removeAttr("isclick");var dstr=textarea_obj.attr("default");var str=textarea_obj.val();if(str==default_data)str="";var sstr=str;if(dstr)var sstr=str.replace(dstr,"");textarea_obj.val(sstr);textarea_obj.insertContent($(this).attr("default-data"))})}function init_comment_rating(obj_name){var result_json=getCookie(comment_rating_cookiename);if(result_json){if(!obj_name||typeof obj_name==undefined){obj_name="#comment"}$(obj_name+" .dingNum").each(function(){if($(this).attr("id")){var rating_cid=$(this).attr("id").split("_")[2];if(rating_cid==""||rating_cid==null||rating_cid=="0"){return false}var comment_rating_cookie_list=json_decode(result_json);if(comment_rating_cookie_list){for(var i in comment_rating_cookie_list){if(comment_rating_cookie_list[i]&&comment_rating_cookie_list[i][0]&&comment_rating_cookie_list[i][0]==rating_cid){if("1"==comment_rating_cookie_list[i][1]){$("#comment .tab_info .comment_listBox li #cdc_support_"+rating_cid).removeAttr("onclick").removeClass("current").addClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+rating_cid).removeAttr("onclick").removeClass("current")}else{$("#comment .tab_info .comment_listBox li #cdc_support_"+rating_cid).removeAttr("onclick").removeClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+rating_cid).removeAttr("onclick").removeClass("current").addClass("current")}}}}}})}}function comment_rating_ajax(type,rating,comment_id,pid,licid){var dingnum=get_rating_num(licid,comment_id,1);var cainum=get_rating_num(licid,comment_id,0);var boo_in_cookie=getBooInCookieArr2(comment_rating_cookiename,comment_id);if(boo_in_cookie){has_rating_omment(comment_id,rating,dingnum,cainum);setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain);alert("您已打分");return false}$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_rating",data:"comment_id="+comment_id+"&rating="+rating,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(rating==0){cainum=cainum+1}else{dingnum=dingnum+1}has_rating_omment(comment_id,rating,dingnum,cainum);if(0==result.error_code){setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain)}return}});return}function show_confirm(){$("#pop-tips").css({left:"50%","margin-left":"-240px",top:"50%","margin-top":"-115px"}).show();$("#cover").show();$("#layerBtnL").removeAttr("onclick");$("#cover").on("click",function(){close_submit_confirm()})}function del_comment_confirm(comment_id){show_confirm();$("#layerBtnL").bind("click",function(){close_submit_confirm();del_comment(comment_id,0)})}function del_comment(comment_id,operator){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+comment_id+"&operator="+operator,dataType:"jsonp",jsonp:"callback",success:function(data){if(0==data.error_code){if(typeof $("#div_comment_"+comment_id)!=undefined){$("#div_comment_"+comment_id).remove()}popUp("","#pop-status-success","删除成功")}else{if(data.error_msg){popUp("","#pop-status-fail",data.error_msg)}else{popUp("","#pop-status-fail","操作失败")}}},error:function(){popUp("","#pop-status-fail","网络错误")}})}function delete_comment_confirm(comment_id){if(window.confirm("确定删除该评论？")){commentDelete(comment_id,1)}}function commentDelete(comment_id,operator){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+comment_id+"&operator="+operator,dataType:"jsonp",jsonp:"callback",success:function(data){if(data.error_code==0){$(".comment_listBox").find("#li_comment_"+comment_id).remove();$(".comment_listBox").find("[blockquote_cid='"+comment_id+"']").remove();popUp("","#pop-status-success","删除成功")}}})}(function($){$.fn.extend({insertContent:function(myValue,t){var $t=$(this)[0];if(document.selection){this.focus();var sel=document.selection.createRange();sel.text=myValue;this.focus();sel.moveStart("character",-l);var wee=sel.text.length;if(arguments.length==2){var l=$t.value.length;sel.moveEnd("character",wee+t);t<=0?sel.moveStart("character",wee-2*t-myValue.length):sel.moveStart("character",wee-t-myValue.length);sel.select()}}else if($t.selectionStart||$t.selectionStart=="0"){var startPos=$t.selectionStart;var endPos=$t.selectionEnd;var scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+myValue+$t.value.substring(endPos,$t.value.length);this.focus();$t.selectionStart=startPos+myValue.length;$t.selectionEnd=startPos+myValue.length;$t.scrollTop=scrollTop;if(arguments.length==2){$t.setSelectionRange(startPos-t,$t.selectionEnd+t);this.focus()}}else{this.value+=myValue;this.focus()}}})})(jQuery);function clearReplyCss(){$("#quickComment").val("");$(".textarea_quick").height("auto")}function commentQuickReply(obj){$(obj).click(function(){if(parseInt($("#log_status").val())!=1){zhiyou_relate.popup_login_show()}else{clearReplyCss();var reply_div=$("#quickReply");var parentid=0;if($(this).attr("id")){parentid=$(this).attr("id").split("_")[2];if(parentid==""||parentid==null||parentid=="0"||parentid==0){parentid=0}reply_div.find("#parentid").val(parentid)}var blank_div=$(this).parent().parent(".comment_conWrap").find(".blankDiv");if($(blank_div).html()==""){$(blank_div).html(reply_div);$("#quickReply").show();$(this).parent(".comment_action").css({display:"block",visibility:"visible"})}else{$("#quickReplyDiv").html(reply_div)}}})}function visibleOrNot(target,parentObj,method){$(target).hover(function(){if(method="visibility"){$(this).children().find(parentObj).css("visibility","visible")}else if(method="display"){$(this).children().find(parentObj).css("display","block")}},function(){if(method="visibility"){$(this).children().find(parentObj).css("visibility","hidden")}else if(method="display"){$(this).children().find(parentObj).css("display","none")}})}function popClose(o){$(o).find(".pop-close").click(function(){$(o).hide()
;$("#cover").hide()});$("#cover").click(function(){$(o).hide();$("#cover").hide()})}function popUp(source,o,txt,isAlwaysShow){if(source!=""){$(source).click(function(){popPosition(o);$(o).show();$("#cover").show();popClose(o)})}else{if(!isAlwaysShow){$(o).find(".pop_info").html(txt);popPosition(o);$(o).show();$("#cover").show();setTimeout(function(){$(o).hide();$("#cover").hide()},2e3);popClose(o)}else{$(o).find(".pop_info").html(txt);popPosition(o);$(o).show();$("#cover").show();popClose(o)}}}function comment_share_to_sina(obj){$(obj).click(function(){var temp_has=0;if($(this).hasClass("icon-rightframe")){temp_has=1;var is_comment_connect="no";$("#comments .comment_share i.check").removeClass("icon-rightframe")}else{temp_has=0;var is_comment_connect="yes";$("#comments .comment_share i.check").addClass("icon-rightframe")}$.ajax({type:"POST",url:"/ajax_set_weibo_connect",data:"isconnect="+is_comment_connect,dataType:"json",success:function(data){if(0!=data.error_code){popUp("","#pop-status-fail",data.error_msg);if(temp_has){$("#comments .comment_share i.check").addClass("icon-rightframe")}else{$("#comments .comment_share i.check").removeClass("icon-rightframe")}}return true}})});return false}function on_check_comment_page(max_page,href,obj){var input_num=$(obj).parent().parent().find(".jumpToPage #input_num").val();var re=/^[1-9]+[0-9]*]*$/;if(re.test(input_num)){if(input_num<=0){input_num=1}if(input_num>max_page){input_num=max_page}location.href=href+"#comments";if(input_num>=1){location.href=href+"p"+input_num+"#comments"}}else{alert("请输入有效数字！")}return true}var comment_tpl={item:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a>{atta}<a class="reply" href="javascript:void(0);" id="cdc_reply_{comment_id}">回复</a></div><div class="blankDiv"></div></div></blockquote>',item_no_atta_reply:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a></div><div class="blankDiv"></div></div></blockquote>'};function show_floors(comment_id,article_id,cate,channel_id,show_at_replay){if(!comment_id||typeof comment_id==undefined||!cate||typeof cate==undefined||cate!="New"&&cate!="Hot"){popUp("","#pop-status-fail","网络错误！");return}if(typeof show_at_replay==undefined){show_at_replay=1}var blockquote_obj=$("#commentTabBlock"+cate+" #li_comment_"+comment_id+" .blockquote_wrap");blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">加载中，请稍候。。。</a>');if(!article_id||typeof article_id==undefined||!channel_id||typeof channel_id==undefined){blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">网络错误，请刷新重试</a>')}var reply_div=$("#quickReply");var is_bgm=$("#is_bgm").val();$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_show_floors",data:"comment_id="+comment_id+"&article_id="+article_id+"&channel_id="+channel_id,dataType:"jsonp",jsonp:"callback",success:function(res){if(res.error_code>0){blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);" onclick="show_floors('+comment_id+","+article_id+", '"+cate+"', '"+channel_id+"', "+show_at_replay+')">网络错误，请重试</a>');return}if(show_at_replay){var tpl_item=comment_tpl.item}else{var tpl_item=comment_tpl.item_no_atta_reply}var comment_list=new StringBuilder("").onMultiAppendBefore(function(param){param["li_comment_id"]=res.data.li_comment_id;param["article_id"]=res.data.article_id;param["channel_id"]=res.data.channel_id;param["user_display_name"]="";param["atta"]="";if(param["home_ta"]){param["user_display_name"]='<a class="a_underline user_name" target="_blank" href="'+param["home_ta"]+'" usmzdmid="'+param["smzdm_id"]+'">'+param["display_name"]+param["post_author"]+"</a>：<p>"+param["content"]+"</p>"}else{param["user_display_name"]='<span class="grey">'+param["display_name"]+param["post_author"]+"</span>：<p>"+param["content"]+"</p>"}if(1!=param["is_anonymous"]){param["atta"]='<a class="atta" href="javascript:void(0);" title="@'+param["display_name"]+'">@TA</a>'}}).appendMultiFormat(tpl_item,res.data.comment_rows).toString();blockquote_obj.html(comment_list);visibleOrNot(".operate_box",".noGoods","visibility");visibleOrNot("blockquote",".comment_action","display");commentQuickReply(blockquote_obj.find(".reply"));if(is_bgm&&typeof is_bgm!=undefined&&blockquote_obj.find("blockquote").length>0){blockquote_obj.find("blockquote").each(function(){var commentID=$(this).attr("blockquote_cid");var userID=$(this).find(".user_name:first").attr("usmzdmid");var mosaicDom='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+commentID+')">打码</a>';var blackListDom='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+userID+'" title="关小黑屋" target="_blank">关小黑屋</a>';if(userID==0||userID==undefined){blackListDom=""}var deleteDom='<a href="javascript:void(0);" onclick="delete_comment_confirm('+commentID+')" title="删除">删除</a>';var editDom='<a href="http://comments.bgm.smzdm.com/comments/info/'+commentID+'" title="编辑" target="_blank">编辑</a>';var controls=mosaicDom+blackListDom+deleteDom+editDom;$(this).find(".dingNum:last").before(controls)})}var quick_reply_obj=$("#quickReplyDiv");if($.trim(quick_reply_obj.html())==""){reply_div.find("#parentid").val(0);quick_reply_obj.html(reply_div)}init_comment_rating("#li_comment_"+comment_id+" .blockquote_wrap");func_atta("#li_comment_"+comment_id+" .blockquote_wrap");func_report("#li_comment_"+comment_id+" .blockquote_wrap");return}});return}function mosaic_show_textarea(cid){$("#pop-mosaic").remove();var article_id=$.trim($("#commentform #pid").val());var channel_id=$.trim($("#commentform #type").val());$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_content/",data:"comment_id="+cid+"&article_id="+article_id,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code){alert(result.error_msg);return false}var old_content=result.data;var html_txt='<div class="pop pop_main_box" id="pop-mosaic" style="display:block;margin-left:-240px;margin-top:-138px;">'+'<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'+'<div class="pop-title"><div class="pop_name">打码</div></div>'+'<div class="pop-content">'+'<div class="pop_width_420">'+'<form id="commentform_'+cid+'">'+'<input type="hidden" name="comment_id" value="'+cid+'" readonly="readonly" />'+'<input type="hidden" name="article_id" value="'+article_id+'" readonly="readonly" />'+'<input type="hidden" name="channel_id" value="'+channel_id+'" readonly="readonly" />'+'<textarea name="old_content" id="old_content" readonly="readonly" style="display:none;">'+old_content+"</textarea>"+'<textarea name="content" id="txt_content_'+cid+'" class="textarea" id="mosaic-textarea" cols="60" rows="5">'+old_content+"</textarea>"+'<div class="a_blockBox"><a href="javascript:void(0);" class="a_redBlock" id="mosaicbtn_'+cid+'" onclick="mosaic_comment('+cid+')">打&nbsp;&nbsp;码</a></div>'+"</form>"+"</div>"+"</div>"+"</div>";var cover=$("#cover");cover.css("display","block");cover.click(function(){$(this).hide();$("#pop-mosaic").hide()});$("#comment").after(html_txt);$("#pop-mosaic").delegate(".pop-close","click",function(){$("#pop-mosaic").hide();cover.css("display","none")});return true},error:function(){alert("网络错误")}});return true}function get_select_txt(id){var select_field=document.getElementById(id);var word="";if(document.selection){var sel=document.selection.createRange();if(sel.text.length>0){word=sel.text}}else if(select_field.selectionStart||select_field.selectionStart=="0"){var startP=select_field.selectionStart;var endP=select_field.selectionEnd;if(startP!=endP){word=select_field.value.substring(startP,endP)}}return word}function mosaic_comment(cid){var mosaic_pre="〖「【《";var mosaic_suf="》】」〗";var mosaic_btn=$("#mosaicbtn_"+cid);var txt_obj=$("#txt_content_"+cid);txt_obj.attr("disabled","disabled");mosaic_btn.attr("disabled","disabled").html("打码中");var con=$.trim(txt_obj.val());var old_con=con;var have_mosaic=con.indexOf(mosaic_pre)>=0||con.indexOf(mosaic_suf)>=0;var sel_txt=get_select_txt("txt_content_"+cid);var con_len=strlen(con);if(con_len>900){alert("该评论内容过长，请去后台操作");txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");return false}if(sel_txt){var newcon=$.trim(txt_obj.val());if(newcon.indexOf(mosaic_pre)>=0||newcon.indexOf(mosaic_suf)>=0){if(confirm("已经有打码内容，请注意不要嵌套打码")){txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else{txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");return true}}else{txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}}else{var regObj={"〖「【《":"","》】」〗":""};for(reg in regObj){con=con.replace(new RegExp(reg,"g"),regObj[reg])}txt_obj.val(con)}txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_edit/",data:$("#commentform_"+cid).serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code){alert(result.error_msg);return false}$(".p_content_"+cid).html(result.data);$("#pop-mosaic").find("#old_content").val(con);return},error:function(XMLHttpRequest){popUp("","#pop-status-fail","网络错误")}});return true}function strlen(s){var w=0;for(var i=0;i<s.length;i++){var c=s.charCodeAt(i);if(c>=1&&c<=126||65376<=c&&c<=65439){w++}else{w+=2}}return w}function vote_by_post_comment(vote_id,post_id,vote_type){if(vote_type!="os"&&vote_type!="exp"){return}if(vote_pid!=post_id){return}if(typeof vote_id=="undefined"){return}if(vote_id==""||vote_id==0){return}var thisUri=document.URL;var toUri=smzdm_site_domain+"youhui/"+post_id;if(thisUri.indexOf(toUri)>=0){var t=$("#respond").offset().top;$(window).scrollTop(t-300)}else{setCookie(vote_id_cookie_key,vote_id,30);setCookie(vote_type_cookie_key,vote_type,30);window.open(toUri+"#comments","_blank")}show_vote_div(vote_id,vote_type);return false}function show_vote_div(vote_id,vote_type){$("#vote_id").val(vote_id);$("#vote_type").val(vote_type);var vote_div=$("#hidden_vote_div");if(vote_div){vote_div.css("display","").html("")}var vote_title=$("#vote_"+vote_type+"_"+vote_id).html();$("#hidden_vote_div").css("display","block").html('<div id="cdc_vote_div" class="voteDiv" style="margin: -5px 10px 10px 0px; color: rgb(187, 2, 0); padding-left: 74px; width: 610px; line-height: 1.6em;">请填写推荐理由，提交后即可为《'+vote_title+"》投票。</div>");return false}function cancle_vote(){$("#vote_id").attr("value",0);$("#vote_type").attr("value","");var vote_div=$("#hidden_vote_div");if(vote_div){vote_div.css("display","none").html("")}}function formatDate(date){var seperator1="-";var seperator2=":";var month=date.getMonth()+1;var strDate=date.getDate();if(month>=1&&month<=9){month="0"+month}if(strDate>=0&&strDate<=9){strDate="0"+strDate}var currentdate=date.getFullYear()+seperator1+month+seperator1+strDate+" "+date.getHours()+seperator2+date.getMinutes()+seperator2+date.getSeconds();return currentdate}function tabCommon(selector,childSelector,tabCont,currentClass,method){if(method=="click"){$(selector).delegate(childSelector,"click",function(){$(this).addClass(currentClass).siblings().removeClass(currentClass);$(tabCont).hide().eq($(selector).find(childSelector).index(this)).show()})}else if(method=="hover"){$(selector).delegate(childSelector,"mouseover",function(){$(this).addClass(currentClass).siblings().removeClass(currentClass);$(tabCont).hide().eq($(selector).find(childSelector).index(this)).show()})}}$(function(){tabCommon(".innerlink-title","span",".innerlink-content","active","hover")});$(document).ready(function(){var gratuity={init:function(){if(!$("#rewardOptions")[0]||!$("#rewardModule")[0]){return false}this.articleId=$("#rewardOptions").attr("data-articleId");this.autherId=$("#rewardOptions").attr("data-autherId");this.avatarImg=$("#rewardOptions").attr("data-avatarImg");this.autherName=$("#rewardOptions").attr("data-autherName");this.channelId=$("#rewardOptions").attr("data-channelId");this.articleTitle=$("#rewardOptions").attr("data-articleTitle")+"";this.rewardOverTime=$("#rewardOptions").attr("data-rewardexpire")==1?true:false;this.channelText="";this.cache_text="";this.auther_call="";switch(this.channelId){case"3":this.title="优惠很值，打赏犒劳爆料人一下";this.channelText="优惠";this.cache_text="爆料";this.auther_call="爆料人";break;default:this.title="文章很值，打赏犒劳作者一下";this.channelText="评测";this.cache_text="创作";this.auther_call="作者"}this.pageNum=10;this.avatarLength=5;this.topLength=3;this.jsonData(1);this.showPageNum=5;this.insertCss("//res.smzdm.com/resources/public/css/gratuity_plug.css")},jsonData:function(pageNum){var that=this;$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+that.channelId+"&article_id="+that.articleId+"&get_total=1&with_top=1&page="+pageNum+"&limit="+that.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(data){that.Data=data;that.insertDom();that.inserAction()},error:function(err){console.log(err)}})},isElement:function(item){if(typeof item!="undefined"&&item.length>=1){return true}return false},insertCss:function(url){try{document.createStyleSheet(url)}catch(e){var cssLink=document.createElement("link");cssLink.rel="stylesheet";cssLink.type="text/css";cssLink.href=url;var head=document.getElementsByTagName("head")[0];head.appendChild(cssLink)}},insertDom:function(){var that=this;var elementDom=[];if(this.channelText=="优惠"){elementDom.push('<div class="reward-box" style="border:0">')}else{elementDom.push('<div class="reward-box" >')}this.title=this.rewardOverTime?"该爆料已过打赏期限":this.title;elementDom.push("<p>"+this.title+"</p>");elementDom.push("<div>");$.ajax({url:"//zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(data){var smzdm_id=""+zhiyou_relate.user_info.smzdm_id;that.autherId=""+that.autherId;if(smzdm_id==that.autherId||that.rewardOverTime){elementDom.push('<a class="reward-btn-no" href="javascript:void(0)">打赏</a>')}else{elementDom.push('<a class="reward-btn" href="javascript:void(0)">打赏</a>')}var data=that.Data.data;if(data.total!=0){elementDom.push('<ul class="reward-head-portrait">');var avatarLength=data.rows.length<=that.avatarLength?data.rows.length:that.avatarLength;for(var k=0;k<avatarLength;k++){var imgSrc=data.rows[k].avatar;var name=data.rows[k].nickname;var url=data.rows[k].user_url;var time=data.rows[k].beauty_time;var id=data.rows[k].smzdm_id;elementDom.push('<li><a href="'+url+'"><img id="'+id+'" src="'+imgSrc+'" name="'+name+'" time="'+time+'"></a></li>')}elementDom.push("</ul>")}if(data.total==0){if(that.rewardOverTime){}else{elementDom.push('<span id="reward-list-msg" data-limit="10">“首席”打赏官正虚席以待！</span>')}}else{if(data.total>10){elementDom.push('<span>等<a class="gratuity-num">'+data.total+"</a>人已打赏</span>")}else{elementDom.push('<span><a class="gratuity-num">'+data.total+"</a>人已打赏</span>")}}elementDom.push('<div class="clearfix"></div>');elementDom.push("</div>");elementDom.push("</div>");var newElementDom=elementDom.join("");$("#rewardModule").html(newElementDom);$("#rewardModule").show();$("article.general_bg").css("margin-bottom","0px");$("#rewardModule").css("padding-top","10px")},error:function(err){console.log(err)}})},inserAction:function(){var that=this;function windowAuto(element,lastElement){function winAuto(){if(window.innerHeight)winHeight=window.innerHeight;else if(document.body&&document.body.clientHeight)winHeight=document.body.clientHeight;var thisHeight=$(element).height();$(lastElement).css("top",(winHeight-thisHeight)/2+"px")}winAuto();window.onresize=winAuto}$("body").on("mouseover",".reward-head-portrait li",function(){var Element=document.createElement("div");Element.className="head-name";var name=$(this).find("img").attr("name");var time=$(this).find("img").attr("time");Element.innerHTML="<em></em><p>"+name+'</p><p class="time">'+time+"</p>";Element.style.top=0-64+"px";$(this).append(Element);var left=$(".head-name").width()/2;$(".head-name").css("left",0-left-5+"px");$(".head-name").find("em").css("left",left+10+"px")});$("body").on("mouseout",".reward-head-portrait li",function(){$(this).find("div.head-name").remove()});$("body").on("click",".reward-btn",function(){$.ajax({url:"//zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(data){var cacheUsrInfo=data;if(cacheUsrInfo.smzdm_id==0){$("#pop-login-new").show();$("#cover").show();$("#zhiyou_login_window_iframe").attr("src",zhiyou_relate.iframe_url);return false}var createHtml=[];createHtml.push('<div class="pop pop_main_box" id="gratuity">');createHtml.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>');createHtml.push('<div class="pop-title">');createHtml.push('<div class="pop_name">打赏</div>');createHtml.push("</div>");createHtml.push('<div class="pop-content" style="padding-bottom:0">');createHtml.push('<div class="pop-interval-30">');createHtml.push('<div class="pop-slogan">');createHtml.push('<a href="http://zhiyou.smzdm.com/member/'+that.autherId+'"><img class="pop-slogan-img" src="'+that.avatarImg+'"></a> 您的支持将鼓励我继续'+that.cache_text+"！");createHtml.push("</div>");createHtml.push('<div class="gratuity-process">');createHtml.push('<div class="gratuity-option">');createHtml.push('<span class="pop_jubao">');createHtml.push('<input type="radio" checked="" class="normal" id="broken_silver" name="report">');createHtml.push('<label for="broken_silver" class="color-gray"><span>碎银子</span>（余额 '+cacheUsrInfo.silver+"）</label>");createHtml.push("</span>");createHtml.push('<span class="pop_jubao">');createHtml.push('<input type="radio" class="normal" id="gold" name="report">');createHtml.push('<label for="gold" class="color-gray"><span>金币</span>（余额 '+cacheUsrInfo.gold+"）</label>");createHtml.push("</span>");createHtml.push("</div>");createHtml.push("打赏数额");createHtml.push('<div class="broken_silver gratuity-option-box">');createHtml.push('<div class="gratuity-price">');createHtml.push("<ul>");createHtml.push('<li value="10">10碎银子</li>');createHtml.push('<li value="50">50碎银子</li>');createHtml.push('<li value="100">100碎银子</li>');createHtml.push("</ul>");createHtml.push('<input class="custom" value="" placeholder="可输入10的倍数">');createHtml.push("<span>碎银子</span>");createHtml.push('<div class="clear"></div>');createHtml.push("</div>");createHtml.push("</div>");createHtml.push('<div class="gold gratuity-option-box">');createHtml.push('<div class="gratuity-price">');createHtml.push("<ul>");createHtml.push('<li value="1">1金币</li>');createHtml.push('<li value="5">5金币</li>');createHtml.push('<li value="10">10金币</li>');createHtml.push("</ul>");createHtml.push('<input class="custom" value="" placeholder="输入数字为整数">');createHtml.push("<span>金币</span>");createHtml.push('<div class="clear"></div>');createHtml.push("</div>");createHtml.push("</div>");createHtml.push('<p class="color-gray">注：碎银子将以10:1的比例转为金币送给'+that.auther_call+"</p>");createHtml.push("</div>");createHtml.push('<div class="gratuity-success">');var titleVal=that.articleTitle.length>25?that.articleTitle.substr(0,25)+"...":that.articleTitle;createHtml.push("<p> 即将对"+that.channelText+"的"+that.auther_call+" "+that.autherName+" 的文章《"+titleVal+'》进行打赏。<br><span class="gratuityOver"></span></p>');createHtml.push("</div>");createHtml.push('<a href="javascript:void(0)" class="a_redBlock gratuity-btn">打&nbsp;&nbsp;赏</a>');createHtml.push('<a href="javascript:void(0)" class="a_redBlock gratuity-ok" style="display:none">确&nbsp;&nbsp;认</a>');createHtml.push('<div class="pop_msg_error"></div>');createHtml.push("</div>");createHtml.push("</div>");createHtml.push("</div>");if(!$("#cover")[0]){createHtml.push('<div id="cover"></div>')}var newHtml=createHtml.join("");$("body").append(newHtml);$("#cover").show();$("#gratuity").show();windowAuto("#gratuity","#gratuity");var gratuity_value={broken_silver:0,gold:0};if(cacheUsrInfo.silver>0){$(".broken_silver ul").find("li").eq(0).addClass("hover");gratuity_value.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value"))}else if(cacheUsrInfo.silver==0&&cacheUsrInfo.gold>0){$("#gold").attr("checked","checked");$(".gold.gratuity-option-box").show();$(".broken_silver.gratuity-option-box").hide();$(".gold ul").find("li").eq(0).addClass("hover");gratuity_value.gold=parseInt($(".gold ul").find("li").eq(0).attr("value"))}else if(cacheUsrInfo.silver==0&&cacheUsrInfo.gold==0){gratuity_value.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value"));$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn")}var clear_li_hover=function(){$(".gratuity-price ul li").removeClass("hover");$("#gratuity input.custom").removeClass("input-error")};$(".gratuity-option span.pop_jubao").click(function(){if(this.getElementsByTagName("input")[0].checked==false){this.getElementsByTagName("input")[0].checked="checked"}var cacheElement=$(this).find("input").attr("id");var stock=function(stockSort,num){if(cacheUsrInfo[stockSort]>num){$(".gratuity-btn").attr("class","a_redBlock gratuity-btn")}else{$(".gratuity-btn").attr("class","a_greyBlock gratuity-btn")}};gratuity_value={broken_silver:0,gold:0};$("#gratuity input.custom").val("");if(cacheElement=="broken_silver"){$(".gratuity-option-box").hide();$(".broken_silver").show();clear_li_hover();$(".broken_silver ul").find("li").eq(0).addClass("hover");gratuity_value.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value"));$(".pop_msg_error").html("");stock("silver",10)}else{$(".gratuity-option-box").hide();$(".gold").show();clear_li_hover();$(".gold ul").find("li").eq(0).addClass("hover");gratuity_value.gold=parseInt($(".gold ul").find("li").eq(0).attr("value"));$(".pop_msg_error").html("");stock("gold",1)}});var tag_is=function(){return $('.gratuity-option input[name="report"]:checked ').attr("id")};$(".gratuity-price ul li").click(function(){clear_li_hover();$(this).addClass("hover");gratuity_value={broken_silver:0,gold:0};gratuity_value[tag_is()]=$(this).attr("value");$(".pop_msg_error").html("");$(".custom").val("");var custom=$(".custom");var popMsgError=$(".pop_msg_error");var gratuityBtn=$(".gratuity-btn");if(tag_is()=="broken_silver"){if(+$(this).attr("value")>+cacheUsrInfo.silver){popMsgError.html("碎银子不足，您可以换个姿势打赏");gratuityBtn.attr("class","a_greyBlock  gratuity-btn")}else{popMsgError.html("");gratuityBtn.attr("class","a_redBlock gratuity-btn")}}else{if(+$(this).attr("value")>+cacheUsrInfo.gold){popMsgError.html("金币不足，您可以换个姿势打赏");gratuityBtn.attr("class","a_greyBlock  gratuity-btn")}else{popMsgError.html("");gratuityBtn.attr("class","a_redBlock gratuity-btn")}}});$(".gratuity-price input.custom").focus(function(){clear_li_hover();gratuity_value={broken_silver:0,gold:0}});var cache_broken_silver=+cacheUsrInfo.silver,cache_gold=+cacheUsrInfo.gold;$(".gratuity-price input.custom").change(function(){var custom=$(".custom");var popMsgError=$(".pop_msg_error");var gratuityBtn=$(".gratuity-btn");$(".pop_msg_error").html("");$(".gratuity-btn").attr("class","a_redBlock gratuity-btn");if(this.value!=""){var element_input=tag_is();if(element_input=="broken_silver"){if(this.value>cache_broken_silver){custom.addClass("input-error");popMsgError.html("碎银子不足，您可以换个姿势打赏");gratuityBtn.attr("class","a_greyBlock  gratuity-btn");return false}else if(this.value==0){custom.addClass("input-error");popMsgError.html("碎银子打赏只支持10的倍数哦");gratuityBtn.attr("class","a_greyBlock  gratuity-btn");return false}else{var cache_value=parseInt(this.value,10);if(cache_value%10==0){gratuity_value.broken_silver=cache_value;gratuityBtn.attr("class","a_redBlock gratuity-btn");custom.removeClass("input-error")}else{custom.addClass("input-error");popMsgError.html("碎银子打赏只支持10的倍数哦");gratuityBtn.attr("class","a_greyBlock  gratuity-btn");return false}}}else if(element_input=="gold"){if(this.value>cache_gold){custom.addClass("input-error");popMsgError.html("余额不足，您可以换个姿势打赏");gratuityBtn.attr("class","a_greyBlock  gratuity-btn");return false}else{var t=/^[1-9]+[0-9]*]*$/;var value=t.test(this.value);if(!value){custom.addClass("input-error");popMsgError.html("金币打赏值只支持整数哦");gratuityBtn.attr("class","a_greyBlock  gratuity-btn");return false}gratuity_value.gold=parseInt(this.value,10);gratuityBtn.attr("class","a_redBlock gratuity-btn");custom.removeClass("input-error")}}}else{custom.addClass("input-error");popMsgError.html("请输入打赏金额！");gratuityBtn.attr("class","a_greyBlock  gratuity-btn")}});$(".gratuity-price input.custom").blur(function(){if(this.value==""){$(".pop_msg_error").html("请输入打赏金额！");$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn")}});$(".gratuity-btn").click(function(){if($(this).attr("class").indexOf("a_redBlock")>-1){for(var a in gratuity_value){console.log("1==",gratuity_value[a]);if(gratuity_value[a]!=0){var gratuityPrice=+gratuity_value[a];var gratuitySort=function(){if(gratuity_value.broken_silver!=0){return 2}else{return 1}}();$(".gratuity-btn").hide();$(".gratuity-ok").css("display","block");$(".gratuity-process").hide();$(".gratuity-success").show();if(gratuitySort==2){$("span.gratuityOver").html("打赏"+gratuityPrice+"碎银子，"+that.auther_call+"将收到"+gratuityPrice/10+"金币")}else if(gratuitySort==1){$("span.gratuityOver").html("打赏"+gratuityPrice+"金币，"+that.auther_call+"将收到"+gratuityPrice+"金币")}$(".security-input").val("");$(".pop_msg_error").html("");var shangA=+cacheUsrInfo.shang.day_has_shang_gold;var shangB=+cacheUsrInfo.shang.day_shang_gold_limit;var shangC=+cacheUsrInfo.shang.day_shang_per_gold_limit;if(gratuitySort==2){gratuityPrice=+gratuityPrice/10}if(gratuityPrice>shangC||shangA+gratuityPrice>=shangB){if(!$("input.security-input")[0]){$(".gratuity-success").append('<div><input type="text" value="" placeholder="请输入安全码" class="security-input"></div>')}$(".gratuity-ok").attr("class","a_redBlock gratuity-ok");var security;if(cacheUsrInfo.is_set_safepass){security='<a target="_blank" href="http://zhiyou.smzdm.com/user/find_password/">忘记安全密码？</a>'}else{security='没有设置安全密码(<a target="_blank" href="http://zhiyou.smzdm.com/user/safepass/">设置安全密码</a>)'}$(".pop_msg_error").html(security)}return false}}$(".pop_msg_error").html("您还没有选择打赏金额！")}});$(".a_redBlock.gratuity-ok").click(function(){if($(this).attr("class").indexOf("a_redBlock")>-1){var coin="";var gratuityStyle=function(){for(var a in gratuity_value){if(gratuity_value[a]!=0){coin=gratuity_value[a];return a=="broken_silver"?2:1}}}();var safetyCode="";if($(".security-input")[0]){safetyCode=$(".security-input")[0].value;if(safetyCode==""){$("#gratuity .pop_msg_error").html('请输入安全密码(<a href="http://zhiyou.smzdm.com/user/find_password/" target="_blank">忘记安全密码</a>)');return false}}$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang?style="+gratuityStyle+"&coin="+coin+"&channel_id="+that.channelId+"&article_id="+that.articleId+"&safepass="+safetyCode,dataType:"jsonp",jsonp:"callback",success:function(data){if(data.error_code==0){$("#gratuity").remove();var okBox=[];var padnum;if(that.channelText=="优惠"){padnum=30}else if(that.channelText=="评测"){padnum=40}okBox.push('<div class="pop pop_no_title gratuityOk" style="width: 300px; text-align: center; padding:'+padnum+'px 0;">');okBox.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>');okBox.push('<div class="pop_jubao oneLine">');okBox.push('<i class="icon-loginright"><!--[if lt IE 8]>√<![endif]--></i>');okBox.push('<p class="pop_info">打赏成功</p>');okBox.push("</div>");okBox.push("</div>");okBox=okBox.join("");$("body").append(okBox);$("div.gratuityOk").show();if(!$(".reward-head-portrait")[0]){var _html=[];_html.push('<ul class="reward-head-portrait">');_html.push("<li>");_html.push('<a href="http://zhiyou.smzdm.com/member/'+cacheUsrInfo.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+cacheUsrInfo.smzdm_id+'/" _tkworked="true">');_html.push('<img src="'+cacheUsrInfo.avatar+'" name="'+cacheUsrInfo.nickname+'" time="刚刚">');_html.push("</a>");_html.push("</li>");_html.push("</ul>");_html.push('<span><a class="gratuity-num" _hover-ignore="1" _orighref="" _tkworked="true">1</a>人已打赏</span>');_html=_html.join("");$(".reward-btn").after(_html);$("span#reward-list-msg").remove();$("a.reward-top span").html("1")}else{var _html=[];_html.push("<li>");_html.push('<a href="http://zhiyou.smzdm.com/member/'+cacheUsrInfo.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+cacheUsrInfo.smzdm_id+'/" _tkworked="true">');_html.push('<img id="'+cacheUsrInfo.smzdm_id+'" src="'+cacheUsrInfo.avatar+'" name="'+cacheUsrInfo.nickname+'" time="刚刚">');_html.push("</a>");_html.push("</li>");_html=_html.join("");var avatarLength=$(".reward-head-portrait li").length;var isMyAvatar=false;for(var r=0;r<avatarLength;r++){if($(".reward-head-portrait").find("li").eq(r).find("img").attr("id")==cacheUsrInfo.smzdm_id){isMyAvatar=true}}if(isMyAvatar){$("#"+cacheUsrInfo.smzdm_id).parents("li").remove();var oldHtml=$(".reward-head-portrait").html();$(".reward-head-portrait").html(_html+oldHtml)}else{if(avatarLength>=that.avatarLength){$(".reward-head-portrait").find("li").eq(avatarLength-1).remove();$(".reward-head-portrait").find("li").eq(0).before(_html)}else{$(".reward-head-portrait").find("li").eq(0).before(_html)}var oldGratuityNum=+$("a.gratuity-num").html();$("a.gratuity-num").html(oldGratuityNum+1);$("a.reward-top span").html(oldGratuityNum+1)}}$(".reward-head-portrait li").hover(function(){var Element=document.createElement("div");Element.className="head-name";var name=$(this).find("img").attr("name");var time=$(this).find("img").attr("time");Element.innerHTML="<em></em><p>"+name+'</p><p class="time">'+time+"</p>";Element.style.top=0-64+"px";$(this).append(Element);var left=$(".head-name").width()/2;$(".head-name").css("left",0-left-5+"px");$(".head-name").find("em").css("left",left+10+"px")},function(){$(this).find("div.head-name").remove()});$("body").on("click","div.gratuityOk i",function(){$(this).parent().remove()});windowAuto("#gratuity-list-box","div.gratuityOk");setTimeout(function(){$("div.gratuityOk").remove();$("#cover").hide()},2e3)}else{$(".pop_msg_error").html(data.error_msg)}},error:function(err){console.log(err)},complete:function(XMLHttpRequest,status){if(status=="timeout"){$("#gratuity .pop_msg_error").html("很抱歉，网络出了点小差，您可以再试")}}})}});var gratuity_init=function(){$(".gratuity-success").hide();$(".gratuity-process").show();$(".gratuity-option-box").hide();$(".broken_silver").show();$(".gratuity-btn").show();$(".gratuity-ok").hide();$(".pop_msg_error").html("");$(".custom").val("");clear_li_hover();$(".gratuity-process ul").find("li").eq(0).addClass("hover");$(".pop_jubao input").attr("checked",false);document.getElementById("broken_silver").checked="checked"};$("body").on("click","span.back_gratuity",gratuity_init)},
error:function(err){console.log(err)}})});function createHTML(createHtml,avatarList){var _length=avatarList.rows.length;for(var i=0;i<_length;i++){if(i>=that.pageNum){break}var imgSrc=avatarList.rows[i].avatar,name=avatarList.rows[i].nickname,url=avatarList.rows[i].user_url,time=avatarList.rows[i].beauty_time;createHtml.push("<li>");createHtml.push('<a href="'+url+'" target="_blank">');createHtml.push('<img src="'+imgSrc+'">');createHtml.push("</a>");createHtml.push('<p><a href="'+url+'">'+name+"</a></p>");createHtml.push("<span>"+time+"</span>");createHtml.push("</li>")}return createHtml}$("body").on("click",".gratuity-num",function(){$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+that.channelId+"&article_id="+that.articleId+"&get_total=1&with_top=1&page="+1+"&limit="+that.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(data){that.Data=data;var topList=that.Data.top_list;var avatarList=that.Data.data;var createHtml=[];createHtml.push('<div class="pop pop_main_box" id="gratuity-list-box">');createHtml.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>');createHtml.push('<div class="pop-title">');createHtml.push('<div class="pop_name">'+avatarList.total+"人已对本文进行打赏</div>");createHtml.push("</div>");createHtml.push('<div class="pop-content" style="padding-bottom:0">');createHtml.push('<div class="pop-interval-30">');if(topList.length!=0&&avatarList.total>=10){that.pageNum=5;createHtml.push('<div class="gratuity_list_new">TOP 打赏</div>');createHtml.push('<ul class="gratuity_list_top">');var topListLength=topList.length>that.topLength?that.topLength:topList.length;for(var i=0;i<topListLength;i++){createHtml.push("<li>");createHtml.push('<span class="sort_value">'+(i+1)+"</span>");createHtml.push('<a href="'+topList[i].user_url+'" target="_blank">');createHtml.push('<img src="'+topList[i].avatar+'">');createHtml.push("</a>");createHtml.push('<span class="sort_txt"><a href="'+topList[i].user_url+'">'+topList[i].nickname+"</a></span>");var total_silver=topList[i].total_silver==0?"":"<span>"+topList[i].total_silver+"</span> 碎银子　";var total_gold=topList[i].total_gold==0?"":"<span>"+topList[i].total_gold+"</span> 金币";createHtml.push('<span class="gratuity_txt">打赏：'+total_silver+total_gold+"</span>");createHtml.push("</li>")}createHtml.push("</ul>")}createHtml.push('<div class="gratuity_list_new">最新打赏</div>');createHtml.push('<ul class="gratuity_list">');createHtml=createHTML(createHtml,avatarList);createHtml.push("</ul>");createHtml.push("</div>");if(avatarList.total>that.pageNum){createHtml.push('<ul class="pagination">');that.pageTotal=avatarList.total%that.pageNum==0?avatarList.total/that.pageNum:parseInt(avatarList.total/that.pageNum,10)+1;var cachePageNum=that.pageTotal>that.showPageNum?that.showPageNum:that.pageTotal;for(var p=0;p<cachePageNum;p++){if(p==0){createHtml.push('<li><a class="pageCurrent" page="'+(p+1)+'">'+(p+1)+"</a></li>")}else{createHtml.push('<li><a page="'+(p+1)+'">'+(p+1)+"</a></li>")}}if(that.pageTotal>1){if(that.pageTotal>that.showPageNum){createHtml.push('<li><span class="dotStyle">...</span></li>')}createHtml.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>')}createHtml.push("</ul>")}createHtml.push("</div>");createHtml.push("</div>");var newHtml=createHtml.join("");$("body").append(newHtml);if(!$("#cover")[0]){$("body").append('<div id="cover"></div>')}$("#cover").show();$("#gratuity-list-box").show();windowAuto("#gratuity-list-box","#gratuity-list-box")},error:function(err){console.log(err)}})});function pagehandle(n,pageNum){var page=n||pageNum;var pageLimit=that.pageNum;$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+that.channelId+"&article_id="+that.articleId+"&get_total=0&with_top=1&page="+page+"&limit="+pageLimit,type:"get",dataType:"jsonp",jsonp:"callback",success:function(data){var avatarList=data.data;var createHtml=[];createHtml=createHTML(createHtml,avatarList);createHtml=createHtml.join("");$("#gratuity-list-box div.pop-interval-30 ul.gratuity_list").html(createHtml);var ul=$("#gratuity-list-box ul.pagination");var thisPage=ul.find("li a.pageCurrent").attr("page"),pageUp=ul.find("li.pageup"),pageDown=ul.find("li.pagedown");function resetDom(){var cacheHtml=[];cacheHtml.push('<li class="pageup"><span>&lt;</span><a>上一页</a></li>');var maxPageNum=that.pageTotal>that.showPageNum?that.showPageNum:that.pageTotal;for(var page=0;page<maxPageNum;page++){cacheHtml.push('<li><a page="'+(page+1)+'">'+(page+1)+"</a></li>")}if(that.pageTotal>that.showPageNum){cacheHtml.push('<li><span class="dotStyle">...</span></li>')}cacheHtml.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>');cacheHtml.join("");ul.html(cacheHtml)}ul.find("li a.pageCurrent").removeClass("pageCurrent");if(n){if(0<n&&n<=that.showPageNum){resetDom();n==1&&ul.find(".pageup").remove();n==that.pageTotal&&ul.find(".pagedown").remove()}ul.find('li a[page="'+n+'"]').addClass("pageCurrent")}else{if(page>thisPage){if(!pageUp[0]){var pageHtml='<li class="pageup"><span>&lt;</span><a>上一页</a></li>';ul.find("li").eq(0).before(pageHtml)}if(0<page&&page<=that.showPageNum){if(that.pageTotal==page){pageDown.remove()}}if(page>that.showPageNum&&page<=that.pageTotal){var pageAttributeDom=ul.find("li a[page]");if(page==that.showPageNum+1){pageAttributeDom[1].outerHTML='<span class="dotStyle">...</span>';pageAttributeDom=ul.find("li a[page]")}var thisPage_lickPage=false;for(var u=0;u<pageAttributeDom.length;u++){if(pageAttributeDom.eq(u).attr("page")==page){thisPage_lickPage=true}}if(!thisPage_lickPage){for(var dom=0;dom<pageAttributeDom.length;dom++){if(pageAttributeDom.eq(dom).attr("page")==1){continue}else{var cachePage=pageAttributeDom.eq(dom).attr("page");pageAttributeDom.eq(dom).attr("page",+cachePage+1).html(+cachePage+1)}}}ul.find('li a[page="'+page+'"]').addClass("pageCurrent");if(that.pageTotal==page){pageDown.remove();ul.find("li").eq(ul.find("li").length-1).remove()}return false}}else if(page<thisPage){if(that.showPageNum<page&&page<=+that.pageTotal-(that.showPageNum-2)){if(!pageDown[0]){ul.append('<li><span class="dotStyle">...</span></li>');var pageHtml='<li class="pagedown"><a>下一页</a><span>&gt;</span></li>';ul.append(pageHtml)}var pageAttributeDom=ul.find("li a[page]");var thisPage_lickPage=false;for(var u=0;u<pageAttributeDom.length;u++){if(pageAttributeDom.eq(u).attr("page")==page){thisPage_lickPage=true}}if(!thisPage_lickPage){for(var dom=0;dom<pageAttributeDom.length;dom++){if(pageAttributeDom.eq(dom).attr("page")==1){continue}else{var cachePage=pageAttributeDom.eq(dom).attr("page");pageAttributeDom.eq(dom).attr("page",+cachePage-1).html(+cachePage-1)}}}}if(0<page&&page<=that.showPageNum){resetDom();if(page==1){ul.find(".pageup").remove()}}}ul.find('li a[page="'+page+'"]').addClass("pageCurrent")}},error:function(err){console.log(err)}})}$("body").on("click","#gratuity-list-box ul.pagination li a",function(){var oldPage=$("#gratuity-list-box ul.pagination li a.pageCurrent").attr("page"),thisP=$(this).attr("page"),thisParentClass=$(this).parent().attr("class");if(thisP&&thisParentClass==null){if(oldPage!=thisP){pagehandle(thisP)}}else if(!thisP&&thisParentClass=="pagedown"){pagehandle(null,+oldPage+1)}else if(!thisP&&thisParentClass=="pageup"){pagehandle(null,+oldPage-1)}});var elementDom=["#gratuity-list-box","#gratuity","div.gratuityOk"];for(var p=0;p<elementDom.length;p++){$("body").on("click",elementDom[p]+" i.pop-close",function(){$(this).parent().remove();$("#cover").hide()})}$("body").on("click","#cover",function(){if($("#gratuity-list-box")[0]){$("#gratuity-list-box").remove()}if($("#gratuity")[0]){$("#gratuity").remove()}if($("div.gratuityOk")[0]){$("div.gratuityOk").remove()}$(this).hide()})}};gratuity.init()});var HISTROY_NAME="s_his";var HIS_DOMAIN=".smzdm.com";$(function(){var $inputSearch=$('header form input[type="search"]');var $form=$inputSearch.closest("form").css("position","relative");if(location.hostname=="2.smzdm.com"){$inputSearch.css("color","#fff")}else{$inputSearch.css("color","#333")}$("header").on("submit","form",function(e){var $self=$(this);var keywords=$('input[name="default_keywords"]').val();var searchFeild=$inputSearch.attr("name");var inputVal=$.trim($inputSearch.val());if(inputVal.length>0){saveHistory(inputVal);return true}e.preventDefault();if($.trim(keywords).length===0)return false;var paramsArr=$self.serializeArray();var params="";$.each(paramsArr,function(index,obj){var and=index===0?"":"&";if(obj.name==searchFeild){obj.value=keywords}params+=and+obj.name+"="+obj.value});window.location=$self.get(0).action+"?"+params});$inputSearch.attr("autocomplete","off");$inputSearch.focus(function(e){var searchHistory=getCookie(HISTROY_NAME);if($inputSearch.val().length||!searchHistory)return;showHistory()}).keyup(function(e){if(e.keyCode>=37&&e.keyCode<=40){e.preventDefault();return}}).keydown(function(e){if(!$form.hasClass("show-history"))return;if(e.keyCode>=37&&e.keyCode<=40){e.preventDefault()}else if(e.keyCode===13){e.preventDefault();if($inputSearch.val().length){sendGA($inputSearch.val())}}}).bind("input propertychange",function(){if($inputSearch.val().length){hideHistory()}else{showHistory()}});$(document).keyup(function(e){var $sHistory=$form.find(".s-history");var keyCodeList=[13,37,38,39,40];if(!$sHistory.length||$sHistory.is(":hidden")||-1===$.inArray(e.keyCode,keyCodeList)){return true}e.preventDefault();e.stopPropagation();var $hisList=$sHistory.find(".s-history-list");var $initFocus=$hisList.find("li.focus");switch(e.keyCode){case 13:$form.append('<input type="hidden" name="source" value="his">');$form.trigger("submit");break;case 37:hideHistory();break;case 38:if($initFocus.length){selectItem($hisList.find("li.focus").index()-1)}else{selectItem($hisList.find("li").length-1)}break;case 39:if($sHistory.is(":visible")&&$inputSearch.val().length){$form.append('<input type="hidden" name="source" value="his">');$form.trigger("submit")}break;case 40:if($initFocus.length){selectItem($hisList.find("li.focus").index()+1)}else{selectItem(0)}break}function selectItem(index){var $list=$sHistory.find(".s-history-list");var $current=$list.find("li.focus");var lastIndex=$list.children().length-1;index=index<0?lastIndex:index>lastIndex?0:index;$current.removeClass("focus");var val=decodeURIComponent($list.children().eq(index).addClass("focus").attr("data-val"));$inputSearch.val(val)}});function saveHistory(input){var oldHistory=getCookie(HISTROY_NAME);if(oldHistory){var oldArr=oldHistory.split(",");var exitIndex=$.inArray(input,oldArr);if(exitIndex>-1){oldArr.splice(exitIndex,1)}if(oldArr.length>=10){oldArr.splice(0,1)}setCookie(HISTROY_NAME,oldArr.join(","),null,"/",HIS_DOMAIN)}setCookieInArr(HISTROY_NAME,input,null,"/",HIS_DOMAIN)}function initHistory(sArr){var $sHistory=createDom(sArr);$sHistory.css("top",$inputSearch.parent().outerHeight());$form.addClass("show-history").append($sHistory);$(document).bind("click",function(e){hideHistory()});$form.on("click",function(e){e.stopPropagation()});$sHistory.on("click",".s-history-head>a",function(e){deleteCookie(HISTROY_NAME);$sHistory.find(".s-history-list li").remove();hideHistory()});$sHistory.on("click","li>.J_his_remove",function(e){var $li=$(this).parent("li");var val=decodeURIComponent($li.attr("data-val"));e.preventDefault();e.stopPropagation();deleteCookieInArr(HISTROY_NAME,val);$li.remove()});$sHistory.on("click",".s-history-list>li>a",function(e){var val=decodeURIComponent($(this).parent().attr("data-val"));$inputSearch.val(val);$form.append('<input type="hidden" name="source" value="his">');$form.trigger("submit")})}function createDom(keywordsArr){var gaClear={event:"站内搜索_历史搜索_清空"};var $listWrap=$("<div/>",{class:"s-history"});var $listHead=$(['<div class="s-history-head">','<span class="grey">最近搜过</span><a href="javascript:;" onclick=\'dataLayer.push('+JSON.stringify(gaClear)+");'>删除历史</a>","</div>"].join(""));var $list=createListDom(keywordsArr);return $listWrap.append($listHead).append($list)}function createListDom(keywordsArr){var $list=$("<ul>",{class:"s-history-list"});$.each(keywordsArr,function(index,keyword){var gaLi={event:"站内搜索_历史搜索_点击","搜索字词":keyword};var gaRemove={event:"站内搜索_历史搜索_删除","搜索字词":keyword};var textShow=keyword;if(keyword.length>20){textShow=keyword.substr(0,20)+"..."}var $li=$("<li/>").attr("data-val",encodeURIComponent(keyword));$li.append($("<a/>",{href:"javascript:;",onclick:"dataLayer.push("+JSON.stringify(gaLi)+")"}).text(textShow)).append($("<span/>",{class:"J_his_remove",onclick:"dataLayer.push("+JSON.stringify(gaRemove)+")"}).html("&times;"));$list.prepend($li)});return $list}function hideHistory(){var $sHistory=$form.find(".s-history");$form.removeClass("show-history");if($sHistory.length){$sHistory.hide();$sHistory.find(".s-history-list>li.focus").removeClass("focus")}}function showHistory(){var searchHistory=getCookie(HISTROY_NAME);var $sHistory=$form.find(".s-history");if(!searchHistory||searchHistory.length===0)return;var searchArr=searchHistory.split(",");$form.addClass("show-history");if($sHistory.length){updateHistory(searchArr);$sHistory.show()}else{initHistory(searchArr)}}function updateHistory(keywordsArr){var $list=createListDom(keywordsArr);$form.find(".s-history .s-history-list").replaceWith($list)}function sendGA(keyword){if(window.dataLayer){window.dataLayer.push({event:"站内搜索_历史搜索_点击","搜索字词":keyword})}}});function focusAjaxRequest(data,callback,$this){$.extend(data,{type:$this.data("type")+"",keyword:$this.data("cate")});$.ajax({type:"get",url:"//zhiyou.smzdm.com/guanzhu/jsonp_follow",dataType:"jsonp",jsonp:"callback",data:data,success:function(resp){callback(resp,$this)},error:function(err){console.log(err);clickUnlock()}})}function focusAjaxCallback(text,status){return function(resp,$this){clickUnlock();if(resp.error_code===0){if(resp.data==="ok"){$this.attr("data-follow",""+status);$this.html(text)}else{console.log(resp.error_msg)}}else if(resp.error_code===1){if(resp.error_msg==="用户未登录"){$(".J_login_trigger").trigger("click")}else{popUp("",".J_focus_pop",resp.error_msg,false)}}else if(resp.error_code===2){popUp("",".J_focus_pop","关注数量超出限制，<br/>请先删除部分内容再尝试",false)}}}function focusMouseEvent(text,$this){if($this.data("type")==="user"){if($this.attr("data-follow")==="2"){$this.html(text)}}else{if($this.attr("data-follow")==="1"){$this.html(text)}}}function clickUnlock(){$(document).off("click",".J_user_focus");$(document).on("click",".J_user_focus",clickLock())}function clickLock(){return function(e){e.preventDefault();$(document).off("click",".J_user_focus");$(document).on("click",".J_user_focus",function(e){e.preventDefault()});var $that=$(this);var text,afterClickFollow;if($that.data("type")==="user"){afterClickFollow=$that.attr("data-follow")==="1"?1:$that.attr("data-follow")==="2"?0:1;text=afterClickFollow===0?"<i>+</i>关注":"取消关注";focusAjaxRequest({follow:afterClickFollow},focusAjaxCallback(text,afterClickFollow===0?1:2),$that)}else{if(location.hostname.indexOf("wiki")===0){afterClickFollow=parseInt($that.attr("data-follow"))===1?0:1;text=afterClickFollow===0?'<i class="icon-zhikujiahao"></i><span><i class="collect_msg">关注</i></span>':'<span><i class="collect_msg">取消关注</i></span>';console.log(text);focusAjaxRequest({follow:afterClickFollow},focusAjaxCallback(text,afterClickFollow),$that)}else{afterClickFollow=parseInt($that.attr("data-follow"))===1?0:1;text=afterClickFollow===0?"<i>+</i>关注":"取消关注";focusAjaxRequest({follow:afterClickFollow},focusAjaxCallback(text,afterClickFollow),$that)}}}}function isFocusAjaxRequest(data,initCallback,bindCallback){$.ajax({type:"get",url:"//zhiyou.smzdm.com/guanzhu/jsonp_is_followed",dataType:"jsonp",jsonp:"callback",data:data,success:function(resp){initCallback(resp);bindCallback()},error:function(err){console.log(err);clickUnlock()}})}function user_foucs_callback(userresp){if(userresp.smzdm_id!=0){$(function(){var $focus=$(".J_user_focus"),$foucsPop=$(".J_focus_pop");if($focus.length){var originalArr=[];$.each($focus,function(key,value){if($(value).data("type")!="user"&&$(value).parents(".meta-tags").length!==0){var dataSend={type:$(value).data("type"),keyword:$(value).data("cate")};$(value).parents(".meta-tags").on("mouseenter",function(){var $that=$(this);$(value).hide();var loading='<img class="J_focus_loading" src="http://res.smzdm.com/pc/v1.0/dist/img/loading.gif" style="vertical-align:-3px;display:inline;margin:auto 5px;">';if(!$(value).parents(".meta-tags").find(".J_focus_loading").length){$(value).parents(".meta-tags").children("div").append(loading)}timeout=setTimeout(function(){isFocusAjaxRequest(dataSend,function(resp){$that.off("mouseenter");if(resp.error_code===0){$(value).parents(".meta-tags").find(".J_focus_loading").remove();$(value).show();$(value).attr("data-follow",""+resp.data.followed);if(resp.data.followed===1){$(value).html("已关注")}else{$(value).html("<i>+</i>关注")}}else{console.log(resp.error_msg)}},function(){clickUnlock()})},200)}).on("mouseleave",function(){if(timeout){clearTimeout(timeout)}})}else if($(value).parents(".meta-tags").length===0){originalArr.push({type:$(value).data("type"),keyword:$(value).data("cate")})}else{originalArr.push({type:"user",keyword:$(value).data("cate")})}});var requestData={keywords:originalArr};if(originalArr.length>0){isFocusAjaxRequest(requestData,function(resp){if(resp.error_code===0){$.each(resp.data,function(key,value){var selector='[data-type="'+value.type+'"][data-cate="'+value.keyword+'"]';$(selector).attr("data-follow",""+value.followed);if(value.type==="user"){if(value.followed===2){$(selector).html("已关注")}else if(value.followed===1){$(selector).html("<i>+</i>关注")}else if(value.followed===0){$(selector).hide()}}else{if(location.hostname.indexOf("wiki")===0){if(value.followed===1){$(selector).html('<span><i class="collect_msg">已关注</i></span>')}else if(value.followed===0){$(selector).html('<i class="icon-zhikujiahao"></i><span><i class="collect_msg">关注</i></span>')}}else{if(value.followed===1){$(selector).html("已关注")}else if(value.followed===0){$(selector).html('<i class="">+</i>关注')}}}})}else{console.log(resp.error_msg)}},function(){if($focus.length){if(location.hostname.indexOf("wiki")===0){$focus.css("padding","1px").on("mouseenter",function(){focusMouseEvent('<span><i class="collect_msg">取消关注</i></span>',$(this))});$focus.css("padding","1px").on("mouseleave",function(){focusMouseEvent('<span><i class="collect_msg">已关注</i></span>',$(this))});$(document).on("click",".J_user_focus",clickLock())}else{$focus.on("mouseenter",function(){focusMouseEvent("取消关注",$(this))});$focus.on("mouseleave",function(){focusMouseEvent("已关注",$(this))});$(document).on("click",".J_user_focus",clickLock())}}})}}})}else{$(function(){var $focus=$(".J_user_focus");$focus.on("click",function(){$(".J_login_trigger").trigger("click")})})}}$(function(){var $tips=$(".J_youhui_tips");if($tips.length){if(getCookie("is_first_youhui")!=="1"){$tips.show();$(document).on("click",".J_youhui_tips i",function(){$tips.hide();setCookie("is_first_youhui","1",999999999,"/")})}}var $tips=$(".J_post_tips");if($tips.length){if(getCookie("is_first_post")!=="1"){$tips.show();$(document).on("click",".J_post_tips i",function(){$tips.hide();setCookie("is_first_post","1",999999999,"/")})}}});$(document).ready(function(){var ua=navigator.userAgent.toLowerCase();var Sys={};var re=/(msie|firefox|chrome|opera|version|crios).*?([\d.]+)/;if(ua.match(re)!=null){var m=ua.match(re);Sys.ver=m[2];var isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var ifqBro=navigator.userAgent.indexOf("QQBrowser");if(isChrome&&parseInt(Sys.ver)<=54&&typeof navigator.credentials=="object"&&ifqBro<0&&!getCookie("chrome_v")){var chrWar="<div class='chrtips-wrap'><p>检测到您的 chrome 浏览器版本不是最新版，为了您的安全浏览和支付购买，请您升级 chrome 浏览器到最新版。<a href='' target='_blank'>去升级</a></p><span class='chrtips-close'>&times</span></div>";var nbwHei=$("#global-nav").height();if($("#global-nav .nav-inner").length){$("#global-nav .nav-inner").append(chrWar);addchrtips()}else{$(window).load(function(){$("#global-nav .nav-inner").append(chrWar);addchrtips()})}function addchrtips(){$(".chrtips-close").on("click",function(){zhiyou_relate.setCookie("chrome_v","1",86400,"/",".smzdm.com",false);$(".chrtips-wrap").remove()});var fWidh=parseInt($("#global-nav .nav-inner").css("width"))-2;$(".chrtips-wrap").css({width:fWidh});if(detectOs()=="Mac"){$(".chrtips-wrap a").attr("href","http://rj.baidu.com/soft/detail/25718.html?ald")}else{$(".chrtips-wrap a").attr("href","http://rj.baidu.com/soft/detail/14744.html")}}}function detectOs(){var sUserAgent=navigator.userAgent;var isWin=navigator.platform=="Win32"||navigator.platform=="Windows";var isMac=navigator.platform=="Mac68K"||navigator.platform=="MacPPC"||navigator.platform=="Macintosh"||navigator.platform=="MacIntel";if(isMac)return"Mac";if(isWin)return"Windows"}}});var commonShare={init:function(){this.initDom();this.closePop()},initDom:function(){var self=this;self.$weibo=$(".icon-weibo-noframe");self.$qq=$(".icon-qq");self.$qzone=$(".icon-qqzone");self.$douban=$(".icon-douban");self.$drawer=$(".icon-drawer");self.$sharelist=$(".common-share-list");self.url=encodeURIComponent(document.URL.replace(/#comments/g,""));self.title=encodeURIComponent(document.title);var eventId="900003",articleId,channel;if(self.$sharelist.length){self.$sharelist.find("i").each(function(k,v){var type=$(this).prop("class");var domain=document.domain;var url=document.URL;if($("#articleIdBang").val()){articleId=$("#articleIdBang").val()}else{if(domain.split(".")[0]==="wiki"){articleId=url.split("/")[4]}else if(domain.split(".")[0]==="test"&&url.split("/")[3]==="yanzheng"){articleId=url.split("/")[4]}else{articleId=url.split("/p/")[1];if(articleId){articleId=articleId.substring(0,articleId.length-1)}}}switch(type){case"icon-weibo-noframe":channel="微博";self.$weibo.parent().attr({href:"http://v.t.sina.com.cn/share/share.php?url="+self.url+"&title="+self.title,onclick:"window.dataLayer.push({'event': '"+eventId+"', '渠道': '"+channel+"', '文章ID': '"+articleId+"'})"});break;case"icon-qqzone":channel="QQ空间";self.$qzone.parent().attr({href:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+self.url+"&title="+self.title,onclick:"window.dataLayer.push({'event': '"+eventId+"', '渠道': '"+channel+"', '文章ID': '"+articleId+"'})"});break;case"icon-qq":channel="QQ";self.$qq.parent().attr({href:"http://connect.qq.com/widget/shareqq/index.html?url="+self.url+"&title="+self.title,onclick:"window.dataLayer.push({'event': '"+eventId+"', '渠道': '"+channel+"', '文章ID': '"+articleId+"'})"});break;case"icon-douban":channel="豆瓣";self.$douban.parent().attr({href:"https://www.douban.com/share/service?href="+self.url+"&name="+self.title,onclick:"window.dataLayer.push({'event': '"+eventId+"', '渠道': '"+channel+"', '文章ID': '"+articleId+"'})"});break;case"icon-drawer":channel="抽屉";self.$drawer.parent().attr({href:"https://dig.chouti.com/digg.action?newsURL="+self.url+"&title="+self.title,onclick:"window.dataLayer.push({'event': '"+eventId+"', '渠道': '"+channel+"', '文章ID': '"+articleId+"'})"});break}});self.$sharelist.find('a:not(".icon-wechat")').attr({target:"_blank"});$(".J_qrcode").attr("data-src",document.URL).each(function(index,el){var $self=$(el);var imgUrl=$self.attr("data-src");var imgW=Number(el.width);var imgH=Number(el.height);var wrapper=el.parentNode;$self.remove();var qrcode=new QRCode(wrapper,{text:imgUrl,width:imgW,height:imgH,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L,showTitle:false})});$(".J_common_shares").click(function(e){$(".J_share_dropdown").hide();$(this).parent().find(".J_share_dropdown").toggle()}).parent().click(function(e){e.stopPropagation()})}},closePop:function(){$("body").on("click",function(e){$(".J_share_dropdown").hide()})}};$(function(){if($(".J_share_dropdown").length){commonShare.init()}});function detailAddEditButton(){var channelID=parseInt($("#channelID").val());var articleID=parseInt($("#articleID").val());var wikiArticleID=parseInt($("#J_article_id").val());var editLink=editUrlFilter(channelID,articleID,wikiArticleID);if(isNaN(channelID)){$(".link_box .operate_box").append('<span class="edit_interface"><a href="'+editLink+'" target="_blank">编辑</a></span>')}else{$(".article_meta:first, article .item-name").append('<span class="edit_interface"><a href="'+editLink+'" target="_blank">编辑</a></span>')}}var publicbgm="Ymdt";var sellbgm="eW91aHVpLmJnbQ==";var postbgm="cG9zdC5iZ20=";var wikibgm="bmV3LXByb2R1Y3QtYmdt";var base64=new Base64;function decodeURL(encodestr){return base64.decode(encodestr)}function changeURL(url,keyword){return url.replace(/\d+/i,decodeURL(keyword))}function editUrlFilter(channelID,articleID,wikiArticleID){var editLink3="http://"+Math.floor(Math.random()*1e5)+".smzdm.com/edit_youhui/"+articleID;var editLink6="http://"+Math.floor(Math.random()*1e5)+".smzdm.com/news/news/edit/"+articleID;var editLink11="http://"+Math.floor(Math.random()*1e5)+".smzdm.com/edit/"+articleID;var wikiLink="http://"+Math.floor(Math.random()*1e5)+".smzdm.com/admin/detail/index?proId="+wikiArticleID;if(isNaN(channelID)){editLink=changeURL(wikiLink,wikibgm)}else{switch(channelID){case 1:editLink=changeURL(editLink3,sellbgm);break;case 3:editLink=changeURL(editLink3,sellbgm);break;case 6:editLink=changeURL(editLink6,publicbgm);break;case 11:editLink=changeURL(editLink11,postbgm);break;default:editLink=""}}return editLink}function addEditInterface(obj){if(obj.attr("articleid")!=undefined){var idArray=obj.attr("articleid").split("_");var channelID=parseInt(idArray[0]);var articleID=parseInt(idArray[1]);var container=obj.find(".lrTop");var editLink=editUrlFilter(channelID,articleID);if(obj.find(".lrTop").length==0){if(channelID==2||channelID==3){container=obj.find(".itemUserInfo")}}container.append('<span class="edit_interface"><a href="'+editLink+'" target="_blank">编辑</a></span>')}}function listAddEditButton(){$(".list").each(function(){if($(this).find(".edit_interface").length==0){addEditInterface($(this))}})}function Base64(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=_utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4)}return output};this.decode=function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=_utf8_decode(output);return output};_utf8_encode=function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext};_utf8_decode=function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string}}